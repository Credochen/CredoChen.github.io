<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> awk学习 · Brightness</title><meta name="description" content="awk学习 - Guangpeng Chen"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">awk学习</h1><div class="post-meta"><div class="post-time">Oct 18, 2015</div></div><div class="post-content"><p>##第一个awk</p>
<p>###print命令打印当前行的全部内容。$0变量表示整个当前行。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#print &#21644; print $0 &#30340;&#20316;&#29992;&#23436;&#20840;&#19968;&#26679;&#12290;&#10;awk &#39;&#123; print $0 &#125;&#39; /etc/passwd&#10;&#10;#&#36755;&#20986;&#19982;&#36755;&#20837;&#25968;&#25454;&#23436;&#20840;&#26080;&#20851;&#30340;&#25968;&#25454;&#65292;&#21482;&#35201;&#23558;&#34;&#34;&#23383;&#31526;&#20018;&#20256;&#36882;&#32473; print &#21629;&#20196;&#23601;&#20250;&#25171;&#21360;&#31354;&#30333;&#21644;&#12290;&#10;awk &#39;&#123; print &#34;&#34; &#125;&#39; /etc/passwd&#10;&#10;#awk &#23545;&#36755;&#20837;&#25991;&#20214;&#20013;&#30340;&#27599;&#19968;&#34892;&#37117;&#25191;&#34892;&#36825;&#20010;&#33050;&#26412;&#65292;&#36816;&#34892;&#36825;&#20010;&#33050;&#26412;&#23558;&#22312;&#24744;&#30340;&#23631;&#24149;&#19978;&#20889;&#28385; hiya&#10;awk &#39;&#123; print &#34;hiya&#34; &#125;&#39; /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>##多个字段<br>awk非常善于处理分成多个逻辑字段的脚本，而且可以毫不费力的应用awk脚本中每个独立的字段<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#25171;&#21360;&#20986;&#31995;&#32479;&#19978;&#25152;&#26377;&#29992;&#25143;&#36134;&#25143;&#30340;&#21015;&#34920;&#10;awk -F&#34;:&#34; &#39;&#123; print $1 &#125;&#39; /etc/passwd</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>notes:-F选项指定 “:”作为字段分隔符；awk处理 print $1命令时，他会打印出在输入文件中每一行中出现的第一个字段</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#25171;&#21360;&#20986;/etc/passwd &#25991;&#20214;&#30340;&#31532;&#19968;&#21644;&#31532;&#19977;&#20010;&#23383;&#27573;&#10;awk -F&#34;:&#34; &#39;&#123; print $1 $3&#125;&#39; /etc/passwd&#10;#&#21152;&#20837;&#31354;&#26684;&#12289;&#25991;&#26412;&#26631;&#31614;&#10;awk -F &#34;:&#34; &#39;&#123; print $1 &#34;\t&#34; $3 &#125;&#39; /etc/passwd&#10;awk -F &#34;:&#34; &#39;&#123; print $1 &#34;\t\tuid:&#34; $3 &#125;&#39; /etc/passwd&#10;#&#23558;&#24471;&#21040;&#31867;&#20284;&#65306;sshd            uid:105...</span><br></pre></td></tr></table></figure>
<p>##外部脚本<br>myscript.awk<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BEGIN &#123;&#10; FS=&#34;:&#34;   #&#35774;&#32622;&#23383;&#27573;&#20998;&#38548;&#31526;&#10;&#125;&#10; &#10;&#123; print $1&#125;</span><br></pre></td></tr></table></figure></p>
<p><br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#25171;&#21360;&#20986; /etc/passwd &#20013;&#27599;&#19968;&#34892;&#30340;&#31532;&#19968;&#20010;&#23383;&#27573;&#10;awk -f myscript.awk /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>##BEGIN 和 END 块<br>通常，对于每个输入行，awk 都会执行每个脚本代码块一次。然而，在许多编<br>程情况中，可能需要在 awk 开始处理输入文件中的文本之前执行初始化代码。<br>对于这种情况，awk 允许您定义一个 BEGIN  块。我们在前一个示例中使用了<br>BEGIN 块。因为 awk  在开始处理输入文件之前会执行 BEGIN 块，因此它是<br>初始化 FS（字段分隔符）变量、打印页眉或初始化其它在程序中以后会引用的<br>全局变量的极佳位置。<br><br>awk 还提供了另一个特殊块，叫作 END 块。awk 在处理了输入文件中的所有<br>行之后执行这个块。通常，END 块用于执行最终计算或打印应该出现在输出流<br>结尾的摘要信息。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BEGIN &#123;&#10;FS=&#34;:&#34;&#10;&#125;&#10;#&#20351;&#29992;&#27491;&#21017;&#34920;&#36798;&#24335;&#10;# /root/ &#123; print $1&#125;&#10;#&#21028;&#26029;&#10;$1==&#34;vagrant&#34; &#123; print &#125;</span><br></pre></td></tr></table></figure>
<p>awk提供了完整的比较运算符集合， <figure class="highlight"><figcaption><span>、"!="、"~"和"！~"```,</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#62; &#36824;&#25552;&#20379;&#20102;```&#8220;~&#8221;&#21644;&#8220;&#65281;~&#8221;```&#36816;&#31639;&#31526;&#65292;&#23427;&#20204;&#20998;&#21035;&#34920;&#31034;&#8220;&#21305;&#37197;&#8221;&#21644;&#8220;&#19981;&#21305;&#37197;&#8221;&#12290;&#10;###&#8220;~&#8221;&#21644;&#8220;&#65281;~&#8221;&#10;1. &#29992;&#27861;&#65306;&#22312;&#36816;&#31639;&#31526;&#24038;&#36793;&#25351;&#23450;&#21464;&#37327;&#65292;&#22312;&#21491;&#36793;&#25351;&#23450;&#35268;&#21017;&#34920;&#36798;&#24335;&#12290;&#10;2. &#31034;&#20363;&#65306;&#22914;&#26524;&#26576;&#19968;&#34892;&#30340;&#31532;&#10;&#20116;&#20010;&#23383;&#27573;&#21253;&#21547;&#23383;&#31526;&#24207;&#21015; root&#65292;&#37027;&#20040;&#20197;&#19979;&#31034;&#20363;&#23558;&#21482;&#25171;&#21360;&#36825;&#19968;&#34892;&#20013;&#30340;&#31532;&#19977;&#20010;&#23383;&#27573;:&#60;br/&#62;```$5 ~ /root/ &#123; print $3&#125;</span><br></pre></td></tr></table></figure></p>
<p>###条件语句<br><strong>类似C语言</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if($5~/root/) &#123;&#10;&#9;print $3&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>###数值变量<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#35745;&#31639;&#31354;&#30333;&#34892;&#10;BEGIN &#123; x=0 &#125;&#10;/^$/ &#123; x=x+1 &#125;&#10;END &#123; print &#34;I found &#34; x &#34; blank lines. &#34; &#125;</span><br></pre></td></tr></table></figure></p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/10/18/《高性能MySQL》读书笔记——Schema与数据类型优化/" class="prev">上一篇</a><a href="/2015/10/18/Shell学习1/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 <a href="http://guangpeng.me">Guangpeng Chen</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>