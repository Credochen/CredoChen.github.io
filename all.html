<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	
  	
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}
	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
					
					<h1><a href="index.html"></a></h1>
					<p class="subtitle"></p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">













								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-22T22:26:09+08:00" itemprop="datePublished">2016/12/22</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="aliyun-rds-data-trans.html" itemprop="url">
		ä¸Šæ‰‹é˜¿é‡Œäº‘RDSé‡åˆ°çš„é—®é¢˜</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<blockquote>
<p>æ˜¨å¤©è´­ä¹°äº†é˜¿é‡Œäº‘çš„RDSæœåŠ¡ï¼Œå‡†å¤‡å°†ECSä¸Šçš„MySQLæ•°æ®è¿ç§»åˆ°RDSä¸Šï¼ŒåŸºäºæ€§èƒ½è€ƒè™‘ã€‚åœ¨è¿™æ®µæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸¤ä¸ªè€—æ—¶å¾ˆä¹…æ‰è§£å†³çš„é—®é¢˜ã€‚è¿™é‡Œè®°å½•ä¸‹ã€‚</p>
</blockquote>

<h2 id="toc_0">é—®é¢˜1. ç›¸åŒåœ°åŒºï¼Œè·¨é˜¿é‡Œäº‘è´¦å·ï¼Œå†…ç½‘æ— æ³•è¿æ¥rdsã€‚</h2>

<blockquote>
<p>é—®é¢˜æè¿°<br/>
æˆ‘æœ‰ä¸¤ä¸ªé˜¿é‡Œäº‘è´¦å·ï¼Œå°±å«Aå’ŒBå§ï¼Œæˆ‘åœ¨Aè´¦å·ä¸‹é¢è´­ä¹°äº†RDSæœåŠ¡ï¼Œæƒ³è¦åœ¨Bè´¦å·ä¸‹é¢çš„ECSæœåŠ¡å™¨å†…é€šè¿‡å†…ç½‘åœ°å€è¿æ¥RDSã€‚<br/>
åœ¨RDSé‡Œé¢å·²ç»åŠ äº†IPç™½åå•ï¼ŒIPåœ°å€éƒ½æ˜¯å†…ç½‘IPã€‚</p>
</blockquote>

<p>æ›¾ä»¥ä¸ºä¸Šiptablesä»¥åŠå®‰å…¨ç»„çš„é—®é¢˜ï¼Œè¯•äº†å¾ˆä¹…éƒ½æ— æ³•æˆåŠŸã€‚æœ€ç»ˆé€šè¿‡å·¥å•è§£å†³äº†ã€‚</p>

<blockquote>
<p>æ‚¨çš„ecså†…éƒ¨æ²¡æœ‰100.64æ®µçš„è·¯ç”±<br/>
æ‚¨çœ‹ä¸‹è¿™ä¸ªè¿æ¥<br/>
<a href="https://help.aliyun.com/knowledge_detail/41762.html">https://help.aliyun.com/knowledge_detail/41762.html</a> </p>
</blockquote>

<ul>
<li>é—®é¢˜åŸå› ï¼šRDSçš„å†…ç½‘åœ°å€å¢åŠ äº†100.64.0.0/10ç½‘æ®µçš„åœ°å€</li>
<li><p>è§£å†³æ–¹æ³•ï¼š</p>

<p>å¦‚æœECSæ²¡100.64.0.0/10è·¯ç”±è®°å½•ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼š</p>

<p>Linux ç›¸å…³ç³»ç»Ÿæ·»åŠ æ–¹æ³•å‚è€ƒï¼š</p>

<p>æ³¨:ä¸‹æ–‡çš„gateway_ipè¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢<br/>
1ï¼‰æŸ¥çœ‹å†…ç½‘ç½‘å…³GATEWAY IP<br/>
    cat /etc/sysconfig/network-scripts/route-eth0<br/>
    ä¸‹é¢çš„gateway_ipéœ€è¦æ›¿æ¢æˆä¸Šé¢æŸ¥è¯¢å¾—åˆ°çš„ç½‘å…³åœ°å€<br/>
2ï¼‰æ‰‹åŠ¨æ·»åŠ é™æ€è·¯ç”±è§„åˆ™ï¼Œå®æ—¶ç”Ÿæ•ˆï¼š<br/>
    ip route add 100.64.0.0/10 via gateway_ip dev eth0<br/>
3ï¼‰æ·»åŠ é™æ€è·¯ç”±åˆ°é…ç½®æ–‡ä»¶ï¼ŒæŒä¹…åŒ–é…ç½®ï¼Œä¸‹æ¬¡é‡å¯ç³»ç»Ÿä¹Ÿèƒ½ç”Ÿæ•ˆï¼š<br/>
    centos/redhat/alios/suse/opensuse ç³»ç»Ÿï¼š<br/>
        echo &quot;100.64.0.0/10 via gateway_ip dev eth0â€ &gt;&gt; /etc/sysconfig/network-scripts/route-eth0<br/>
    ubuntu/debian ç³»ç»Ÿï¼š<br/>
        echo &quot;up route add -net 100.64.0.0 netmask 255.192.0.0 gw gateway_ip dev eth0&quot; &gt;&gt; /etc/network/interfaces<br/>
    gentoo ç³»ç»Ÿï¼š<br/>
        echo &quot;routes_eth0=(&quot;100.64.0.0/10 via gateway_ip&quot;)&quot; &gt;&gt; /etc/conf.d/net<br/>
4ï¼‰æ£€æŸ¥è·¯ç”±æ˜¯å¦è®¾ç½®æˆåŠŸï¼š<br/>
    ip route show | grep &#39;100.64.0.0/10&#39; 100.64.0.0/10 via gateway_ip dev eth0</p></li>
</ul>

<h2 id="toc_1">é—®é¢˜2ï¼Œåœ¨ä½¿ç”¨DTSè¿ç§»æ•°æ®çš„æ—¶å€™ï¼Œæºæ•°æ®åº“çš„è´¦å·å¦‚ä½•é…ç½®åˆé€‚</h2>

<blockquote>
<p>é—®é¢˜æè¿°ï¼šåœ¨è¿ç§»æ•°æ®çš„æ—¶å€™ï¼Œé€‰æ‹©â€œæœ‰å…¬ç½‘ipçš„è‡ªå»ºæ•°æ®åº“â€ï¼Œ<br/>
æºåº“ä¿¡æ¯çš„ä¸»æœºåæˆ–IPåœ°å€ï¼Œä½¿ç”¨ecsçš„å†…ç½‘ipï¼Œç„¶åecsæœåŠ¡å™¨ä¸Šçš„è¿ç§»æ•°æ®åº“è´¦å·ï¼Œé…ç½®çš„ä¸»æœºæ˜¯rdsçš„å†…ç½‘åœ°å€æ˜¯å¦å¯è¡Œï¼Ÿ</p>
</blockquote>

<p>dtsåœ¨è¿ç§»æ—¶å¹¶ä¸æ˜¯rdså»è¿æ‚¨çš„æº,è€Œæ˜¯dtsè¿çš„. æ‰€ä»¥æ‚¨é…ç½®hostä¸ºrdsçš„ipæ˜¯ä¸å¯¹çš„. è€Œdtsåˆæ˜¯ä¸€ä¸ªé›†ç¾¤,æ²¡æœ‰å›ºå®šçš„ip,æ‰€ä»¥å»ºè®®æ‚¨é…ç½®hostä¸º%,å°±å¯ä»¥äº†ï¼Œåœ¨é…ç½®çš„DTSçš„æ—¶å€™ï¼Œæºåº“ä¿¡æ¯çš„ä¸»æœºæˆ–ipåœ°å€å¡«å†™æ•°æ®çš„å†…ç½‘ipåœ°å€ï¼Œå°±å¯ä»¥äº†ã€‚</p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-19T21:36:29+08:00" itemprop="datePublished">2016/12/19</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="stroing_mac_addr_in_mysql.html" itemprop="url">
		MySQLç”¨ä»€ä¹ˆç±»å‹çš„å­—æ®µå­˜å‚¨macåœ°å€åˆé€‚ï¼Ÿ</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>å·¥ä½œä¸­é‡åˆ°éœ€è¦å­˜å‚¨ç¡¬ä»¶çš„è®¾å¤‡çš„macåœ°å€ï¼Œæƒ³åˆ°æˆ‘ä»¬å¯ä»¥ç”¨<code>ip2long</code>,<code>long2ip</code>ä¸¤ä¸ªå‡½æ•°æ¥å­˜å‚¨å’Œè§£æipåœ°å€ï¼Œé‚£ä¹ˆmacåœ°å€åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>

<h2 id="toc_0">macåœ°å€æ ¼å¼</h2>

<blockquote>
<p>MACåœ°å€å…±48ä½ï¼ˆ6ä¸ªå­—èŠ‚ï¼‰ï¼Œä»¥åå…­è¿›åˆ¶è¡¨ç¤ºã€‚æ¯”å¦‚ï¼š 01:23:45:67:78:AB</p>

<p>è¿™æ„å‘³ç€æ¯ä¸ªåå…­è¿›åˆ¶å­—æ®µå¯ä»¥å­˜å‚¨256ï¼ˆä»¥10ä¸ºåŸºæ•°çš„2çš„8çš„å¹‚ï¼‰å€¼ã€‚ æ¯ä¸ªå€¼ä¸º8ä½ï¼ˆ= 1å­—èŠ‚ï¼‰ã€‚</p>
</blockquote>

<p>6 field x 8 bit = 48 bit = 6 bytes</p>

<h2 id="toc_1">æ•°æ®åº“å­—æ®µè®¾è®¡</h2>

<p>ä½¿ç”¨<code>bigint unsigned</code>å­˜å‚¨ã€‚</p>

<blockquote>
<p>bigint æ”¯æŒçš„æ•°æ®èŒƒå›´ï¼šæ”¯æŒ -9223372036854775808åˆ°9223372036854775807(SIGNED)ï¼Œ0åˆ°18446744073709551615(UNSIGNED)ï¼Œéœ€è¦8ä¸ªå­—èŠ‚å­˜å‚¨</p>
</blockquote>

<pre><code class="language-sql">-- ä¿å­˜
INSERT INTO `devices` (mac_addr) VALUES (x&#39;0123456789AB&#39;);
-- è¯»å–
SELECT HEX(mac_addr) FROM `devices`;
</code></pre>

<h2 id="toc_2">PHPå¤„ç†</h2>

<pre><code class="language-php">function mac2int($mac) {
    return base_convert($mac, 16, 10);
}

function int2mac($int) {
    return base_convert($int, 10, 16);
}
// æ›´åŠ äººæ€§åŒ–çš„è¯»å–
function int2macaddress($int) {
    $hex = base_convert($int, 10, 16);
    while (strlen($hex) &lt; 12)
        $hex = &#39;0&#39;.$hex;
    return strtoupper(implode(&#39;:&#39;, str_split($hex,2)));
}
</code></pre>

<ul>
<li>å‚è€ƒï¼š<a href="http://www.onurguzel.com/storing-mac-address-in-a-mysql-database/">Storing MAC address in a MySQL database</a></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-11T21:23:24+08:00" itemprop="datePublished">2016/12/11</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="lets-encrypt.html" itemprop="url">
		è·å–Let's Encryptçš„è¯ä¹¦</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2 id="toc_0">è·å–CertBot</h2>

<pre><code class="language-bash">wget https://dl.eff.org/certbot-auto
chmod a+x certbot-auto
</code></pre>

<h2 id="toc_1">nginx é…ç½®</h2>

<blockquote>
<p>é’ˆå¯¹ä¸é€šçš„åŸŸåï¼Œéƒ½è¦æœ‰ç›¸åº”çš„é…ç½®ã€‚åœ¨Serverä¸‹å¢åŠ ä¸‹é¢çš„location</p>
</blockquote>

<pre><code>location ^~ /.well-known/acme-challenge/ {
   default_type &quot;text/plain&quot;;
   root     /opt/openresty/nginx/html/;
}
location = /.well-known/acme-challenge/ {
   return 404;
}
</code></pre>

<h2 id="toc_2">è·å–è¯ä¹¦</h2>

<pre><code class="language-bash">./certbot-auto certonly --email coder@example.com \
-w /opt/openresty/nginx/html/ -d example.domain.com \
--nginx --nginx-server-root /opt/openresty/nginx \
--nginx-ctl /usr/local/nginx/nginx
</code></pre>

<blockquote>
<p>--nginx-server-root NGINX_SERVER_ROOT<br/>
     Nginx server root directory. (default: /etc/nginx)<br/>
--nginx-ctl NGINX_CTL<br/>
     Path to the &#39;nginx&#39; binary, used for &#39;configtest&#39; and<br/>
     retrieving nginx version number. (default: nginx)</p>
</blockquote>

<h2 id="toc_3">è‡ªåŠ¨ç»­æœŸ--renew</h2>

<blockquote>
<p>Let&#39;s Encrypt çš„è¯ä¹¦æœ‰æ•ˆæœŸä¸º 90 å¤©ï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆ°æœŸå‰ renew ä¸€ä¸‹è¯ä¹¦ã€‚</p>
</blockquote>

<pre><code class="language-bash"># æ¯éš” 80 å¤©çš„å‡Œæ™¨ 4 ç‚¹æ‰§è¡Œä¸€æ¬¡ renewï¼š
0 4 */80 * * /root/certbot-auto certonly renew --email coder@example.com -w /var/www/html/open -d example.domain.com &amp;&gt;&gt; /tmp/certbot-renew.log
</code></pre>

<h2 id="toc_4">ä¿®æ”¹Nginxï¼Œå¯ç”¨Https</h2>

<pre><code class="language-bash">listen 443 ssl;
listen [::]:443 ssl ipv6only=on;# å¦‚æœæœåŠ¡å™¨æœªå¯ç”¨ipv6ï¼Œä¸è¦å†™è¿™é¡¹é…ç½®
ssl_certificate /etc/letsencrypt/live/www.12301dev.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/www.12301dev.com/privkey.pem;
ssl_trusted_certificate /etc/letsencrypt/live/www.12301dev.com/chain.pem;
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-11T21:22:04+08:00" itemprop="datePublished">2016/12/11</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql57-install.html" itemprop="url">
		Centos 6.5 ç¼–è¯‘å®‰è£…MySQL 5.7</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2 id="toc_0">ç¼–è¯‘å®‰è£…</h2>

<pre><code class="language-bash">cmake . -DCMAKE_INSTALL_PREFIX=/usr/local/mysql57 \
-DSYSCONFDIR=/usr/local/mysql57 \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DENABLED_LOCAL_INFILE=ON \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_FEDERATED_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 \
-DWITH_READLINE=ON \
-DSYSCONFDIR=/data/mysql3326 \
-DWITH_BOOST=/usr/local/boost \
-DMYSQL_UNIX_ADDR=/data/mysql3326/mysql.sock

make -j #åŠ cpuæ ¸å¿ƒæ•°å¯ä»¥æ›´å¿«ï¼
make install
</code></pre>

<h2 id="toc_1">åˆå§‹åŒ–æ•°æ®(ä¸5.6ä¹‹å‰çš„åˆå§‹åŒ–ä¸åŒäº†ï¼)</h2>

<pre><code class="language-bash">/usr/local/mysql57/bin/mysqld --defaults-file=/usr/local/mysql57/my.cnf --initialize 
# è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°ä¸€ä¸ªrootçš„åˆå§‹å¯†ç ï¼Œä¹Ÿä¼šåœ¨error logé‡Œé¢

# æ‹·è´å¯åŠ¨æ–‡ä»¶
cp support-files/mysql.server /etc/init.d/mysql57
# ä¿®æ”¹æƒé™
chmod u+x /etc/init.d/mysql57
# å¯åŠ¨
service mysql57 start

# ç™»å½•
mysql -uroot -p -S
</code></pre>

<h2 id="toc_2">åç»­æ“ä½œ</h2>

<pre><code class="language-sql">-- ä¿®æ”¹åˆå§‹å¯†ç 
SET PASSWORD = PASSWORD(&#39;123456&#39;);
-- å¢åŠ æƒé™
GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;127.0.0.1&#39; IDENTIFIED BY &#39;123467&#39; WITH GRANT OPTION;
</code></pre>

<h2 id="toc_3">å‚è€ƒ</h2>

<p><a href="http://blog.csdn.net/yumushui/article/details/45534199">MySQL 5.7.7ç¼–è¯‘å®‰è£…è¿‡ç¨‹</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-11T21:22:04+08:00" itemprop="datePublished">2016/12/11</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="http2-nginx.html" itemprop="url">
		HTTP/2 + nginxé…ç½®</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2 id="toc_0">ç”³è¯·å…è´¹çš„sslè¯ä¹¦</h2>

<p>å¯ä»¥å‚è€ƒ<a href="./lets-encrypt.html">è·å–Let&#39;s Encryptçš„è¯ä¹¦</a></p>

<h2 id="toc_1">å®‰è£…nginx</h2>

<pre><code class="language-bash">./configure --prefix=/usr/local/nginx \
--with-http_v2_module \
--with-http_ssl_module  \
--with-zlib=/data/software/zlib-1.2.8  \
--with-openssl=/data/software/openssl-1.0.2j \

make -j 4
make install
</code></pre>

<p><strong>è¦æ”¯æŒhttp/2ï¼Œopensslç‰ˆæœ¬å¿…é¡»è¦æ˜¯1.0.2ï¼ˆæˆ–ä»¥ä¸Šï¼‰</strong></p>

<h2 id="toc_2">é…ç½®</h2>

<pre><code class="language-bash">      listen       443 http2 ssl default_server;
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubdomains; preload&quot;;
    server_name  www.guangpeng.me;
    ssl_certificate /usr/loca/nginx/conf/certs/demo.crt;
    ssl_certificate_key /usr/loca/nginx/conf/certs/demo.key;
    ssl_session_cache    shared:SSL:1m;
    ssl_session_timeout  5m;
</code></pre>

<h2 id="toc_3">å‚è€ƒ</h2>

<ul>
<li><a href="http://hectorguo.com/zh/http2-starter/">è°ˆè°ˆHTTP/2å¯¹å‰ç«¯çš„å½±å“</a></li>
<li><a href="http://op.baidu.com/2015/04/https-s01a03/">å¤§å‹ç½‘ç«™çš„ HTTPS å®è·µï¼ˆä¸‰ï¼‰â€”â€”åŸºäºåè®®å’Œé…ç½®çš„ä¼˜åŒ–</a></li>
<li><a href="https://linux.cn/article-5266-1.html">å¦‚ä½•é…ç½®ä½¿ç”¨ HTTP ä¸¥æ ¼ä¼ è¾“å®‰å…¨ï¼ˆHSTSï¼‰</a></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql-1.html" itemprop="url">
		ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°â€”â€”æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h3 id="toc_0">ä¼˜åŒ–COUNT() æŸ¥è¯¢</h3>

<ul>
<li>åˆ—å€¼ç»Ÿè®¡æ—¶è¦æ±‚åˆ—å€¼æ˜¯éç©ºçš„ï¼ˆä¸ç»Ÿè®¡NULLï¼‰ã€‚å½“æ‹¬å·å†…æŒ‡å®šäº†åˆ—æˆ–è€…åˆ—çš„è¡¨è¾¾å¼ï¼Œåˆ™ç»Ÿè®¡çš„å°±æ˜¯è¿™ä¸ªè¡¨è¾¾å¼æœ‰å€¼çš„ç»“æœæ•°ã€‚</li>
<li>å½“MySQLç¡®è®¤æ‹¬å·å†…çš„è¡¨è¾¾å¼å€¼ä¸å¯èƒ½ä¸ºç©ºæ˜¯ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ç»Ÿè®¡è¡Œæ•°ã€‚â€”â€”COUNT(*)ã€‚</li>
<li>å¦‚æœå¸Œæœ›çŸ¥é“çš„æ˜¯ç»“æœé›†çš„è¡Œæ•°ï¼Œæœ€å¥½ä½¿ç”¨<strong>COUNT(*)</strong>ã€‚</li>
<li>å…³äºMyISAMçš„ç¥è¯

<ul>
<li>åªæœ‰æ²¡æœ‰ä»»ä½•WHEREæ¡ä»¶çš„<strong>COUNT(*)</strong>æ‰éå¸¸å¿«ï¼Œå› ä¸ºæ­¤æ—¶æ— éœ€å®é™…åœ°å»è®¡ç®—è¡¨çš„è¡Œæ•°ã€‚</li>
</ul></li>
</ul>

<hr/>

<ul>
<li>ä¼˜åŒ–å‰ï¼š
<code>sql
SELECT COUNT(\*) FROM world.City WHERE id&gt;5
</code></li>
<li>ä¼˜åŒ–åï¼š
<code>sql
SELECT (SELECT COUNT(\*) FROM world.City) - COUNT(\*) FROM world.City
WHERE id&lt;=5
</code>
### ä¼˜åŒ–å…³è”æŸ¥è¯¢</li>
<li>ç¡®ä¿ONæˆ–è€…USINGå­—å¥ä¸­çš„åˆ—ä¸Šæœ‰ç´¢å¼•ã€‚</li>
<li>ç¡®ä¿ä»»ä½•çš„GROUP BY å’ŒORDER BY ä¸­çš„è¡¨è¾¾å¼åªæ¶‰åŠåˆ°ä¸€ä¸ªè¡¨ä¸­çš„åˆ—ï¼Œè¿™æ ·MySQLæ‰æœ‰å¯èƒ½ä½¿ç”¨ç´¢å¼•æ¥ä¼˜åŒ–è¿™ä¸ªè¿‡ç¨‹</li>
</ul>

<h3 id="toc_1">ä¼˜åŒ–å­æŸ¥è¯¢</h3>

<p><strong>å°½å¯èƒ½</strong> çš„ä½¿ç”¨å…³è”æŸ¥è¯¢ä»£æ›¿ã€‚</p>

<h3 id="toc_2">ä¼˜åŒ–GROUP BY å’ŒDISTINCT</h3>

<p>é‡‡ç”¨æŸ¥æ‰¾è¡¨çš„æ ‡è¯†åˆ—åˆ†ç»„çš„æ•ˆç‡ä¼šæ¯”å…¶ä»–åˆ—æ›´é«˜ã€‚</p>

<h3 id="toc_3">ä¼˜åŒ–LIMITåˆ†é¡µ</h3>

<blockquote>
<p>åœ¨åç§»é‡éå¸¸å¤§çš„æ—¶å€™ï¼Œä¾‹å¦‚å¯èƒ½æ˜¯LIMIT 10000ï¼Œ20è¿™æ ·çš„æŸ¥è¯¢ï¼Œè¿™æ—¶MySQLéœ€è¦æŸ¥è¯¢10020æ¡è®°å½•ç„¶ååªè¿”å›20æ¡ï¼Œå‰é¢çš„10000æ¡éƒ½å°†è¢«æŠ›å¼ƒã€‚</p>
</blockquote>

<ul>
<li>è¦ä¼˜åŒ–è¿™ç§æŸ¥è¯¢ï¼Œè¦ä¹ˆæ˜¯åœ¨é¡µé¢ä¸­é™åˆ¶åˆ†é¡µçš„æ•°é‡ï¼Œè¦ä¹ˆæ˜¯ä¼˜åŒ–å¤§åç§»é‡çš„æ€§èƒ½ã€‚</li>
<li>ä¸€ä¸ªæœ€ç®€å•çš„åŠæ³•å°±æ˜¯å°½å¯èƒ½åœ°ä½¿ç”¨ç´¢å¼•è¦†ç›–æ‰«æï¼Œè€Œä¸æ˜¯æŸ¥è¯¢æ‰€æœ‰çš„åˆ—ã€‚ç„¶åæ ¹æ®éœ€è¦åšä¸€æ¬¡å…³è”æ“ä½œå†è¿”å›æ‰€éœ€çš„åˆ—ã€‚è€ƒè™‘ä¸‹é¢çš„æŸ¥è¯¢ï¼š
<code>sql
mysql&gt; SELECT film_id, description FROM sakila.film ORDER BY title LIMIT 50,5;
</code>
å¦‚æœè¿™å¼ è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆä¸‹é¢çš„è¯­å¥å°†å¤§å¤§æé«˜æ•ˆç‡ã€‚
<code>sql
mysql&gt; SELECT film_id, description FROM  sakila.film INNER JOIN (SELECT film_id FROM sakila.film ORDER BY title LIMIT 50,5) AS lim USING(film_id);
</code></li>
<li>LIMITå’ŒOFFSETçš„é—®é¢˜ï¼Œå…¶å®æ˜¯OFFSETçš„é—®é¢˜ï¼Œå®ƒä¼šå¯¼è‡´MySQLæ‰«æå¤§é‡ä¸éœ€è¦çš„è¡Œç„¶åå†æŠ›å¼ƒæ‰ã€‚å¦‚æœå¯ä»¥ä½¿ç”¨ä¹¦ç­¾è®°å½•ä¸Šæ¬¡æ•°æ®çš„ä½ç½®ï¼Œé‚£ä¹ˆä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥ä»è¯¥ä¹¦ç­¾è®°å½•çš„ä½ç½®å¼€å§‹æ‰«æï¼Œè¿™æ ·å¯ä»¥é¿å…ä½¿ç”¨OFFSETã€‚å¦‚ï¼š
<code>sql
mysql&gt; SELECT * FROM sakila.rental ORDER BY rental_id DESC LIMIT 20;
</code>
å‡è®¾ä¸Šé¢æŸ¥è¯¢è¿”å›çš„ä¸»é”®ä¸º16049åˆ°16030ï¼Œé‚£ä¹ˆä¸‹ä¸€é¡µçš„æŸ¥è¯¢å°±å¯ä»¥ä»16030å¼€å§‹ã€‚
<code>sql
mysql&gt; SELECT * FROM sakila.rental WHERE rental_id&lt;16030 ORDER BY rental_id DESC LIMIT 20;
</code></li>
</ul>

<h3 id="toc_4">ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h3>

<p>é¿å…é‡å¤æŸ¥è¯¢åˆšåˆšæ›´æ–°çš„æ•°æ®<br/>
<code>sql<br/>
    #bad sql<br/>
    mysql&gt; UPDATE t1 SET lastUpdate = NOW() WHERE id=1;<br/>
    mysql&gt; SELECT lastUpdate FROM t1  WHERE id=1<br/>
    #good sql<br/>
    mysql&gt; UPDATE t1 SET lastUpdate = NOW() WHERE id=1 AND @now := NOW();<br/>
    mysql&gt; SELECT @not;<br/>
</code></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql-2.html" itemprop="url">
		ã€Šé«˜æ€§èƒ½MySQLã€‹è¯»ä¹¦ç¬”è®°â€”â€”Schemaä¸æ•°æ®ç±»å‹ä¼˜åŒ–</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h3 id="toc_0">é€‰æ‹©ä¼˜åŒ–çš„æ•°æ®ç±»å‹</h3>

<ul>
<li>æ›´å°çš„é€šå¸¸æ›´å¥½ï¼š

<ul>
<li>æ›´å°çš„æ•°æ®ç±»å‹é€šå¸¸æ›´å¿«ï¼Œå› ä¸ºå®ƒä»¬å ç”¨æ›´å¥½çš„ç£ç›˜ã€å†…å­˜å’Œcpuç¼“å­˜ï¼Œå¹¶ä¸”å¤„ç†æ—¶éœ€è¦çš„cpuå‘¨æœŸæ›´å°‘ã€‚</li>
<li><strong>ä½†æ˜¯è¦ç¡®ä¿æ²¡æœ‰ä½ä¼°éœ€è¦å­˜å‚¨çš„å€¼çš„èŒƒå›´ï¼›å¦‚æœæ— æ³•ç¡®å®šå“ªä¸ªæ•°æ®ç±»å‹æ˜¯æœ€å¥½çš„ï¼Œå°±é€‰æ‹©è‡ªå·±è®¤ä¸ºä¸ä¼šè¶…è¿‡èŒƒå›´çš„æœ€å°ç±»å‹ã€‚</strong></li>
</ul></li>
<li>ç®€å•å°±å¥½ï¼š

<ul>
<li>ç®€å•çš„æ•°æ®ç±»å‹çš„æ“ä½œé€šå¸¸éœ€è¦æ›´å°‘çš„cpuå‘¨æœŸã€‚</li>
<li>eg:æ•´å‹ VS å­—ç¬¦å‹ï¼Œåº”è¯¥ä½¿ç”¨MySQLå†…å»ºçš„ç±»å‹å­˜å‚¨æ—¶é—´å’Œæ—¥æœŸè€Œä¸æ˜¯ç”¨å­—ç¬¦ä¸²ï¼Œåº”è¯¥ä½¿ç”¨æ•´å‹å­˜å‚¨IPåœ°å€ã€‚</li>
</ul></li>
<li>å°½é‡é¿å…NULLï¼š

<ul>
<li>å¦‚æœæŸ¥è¯¢ä¸­åŒ…å«å¯ä¸ºNULLçš„åˆ—ï¼Œå¯ä¸ºNULLçš„åˆ—ä½¿å¾—ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡çš„å€¼æ¯”è¾ƒéƒ½è·Ÿå¤æ‚ï¼›</li>
<li>å¯ä¸ºNULLçš„åˆ—ä¼šä½¿ç”¨æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼›</li>
<li>é€šå¸¸æŠŠå¯ä¸ºNULLçš„åˆ—æ”¹ä¸ºNOT NULLå¸¦æ¥çš„æ€§èƒ½æå‡æ¯”è¾ƒå°ï¼›</li>
<li>ä½†æ˜¯å¦‚æœè®¡åˆ’åœ¨åˆ—ä¸Šå»ºç´¢å¼•ï¼Œå°±åº”è¯¥å°½é‡é¿å…è®¾è®¡æˆå¯ä¸ºNULLçš„åˆ—ã€‚</li>
</ul></li>
</ul>

<h3 id="toc_1">é€‰æ‹©æ•°æ®ç±»å‹</h3>

<blockquote>
<p>DATATIMEå’ŒTIMESTAMP:<br /><br/>
DATETIMEå’ŒTIMESTAMPéƒ½å¯ä»¥å­˜å‚¨ç›¸åŒç±»å‹çš„æ•°æ®ï¼Œç„¶è€ŒTIMESTAMPåªä½¿ç”¨DATETIMEä¸€åŠçš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”ä¼šæ ¹æ®æ—¶åŒºå˜åŒ–ï¼Œå…·æœ‰ç‰¹æ®Šçš„è‡ªåŠ¨æ›´æ–°èƒ½åŠ›ã€‚å¦ä¸€æ–¹é¢ï¼ŒTIMESTAMPå…è®¸çš„æ—¶é—´èŒƒå›´è¦å°çš„å¤šã€‚</p>
</blockquote>

<h3 id="toc_2">æ•´æ•°ç±»å‹</h3>

<ul>
<li>TINYINT,SMALLINT,MEDIUMINT,INT,BIGINTï¼Œåˆ†åˆ«ä½¿ç”¨8,16,24,32,64ä½å­˜å‚¨ç©ºé—´ï¼Œå®ƒä»¬å¯ä»¥å­˜å‚¨çš„å€¼çš„èŒƒå›´ä»pow(-2,N-1)åˆ°pow(2,(N-1)-1),å…¶ä¸­Næ˜¯å­˜å‚¨ç©ºé—´çš„ä½æ•°ï¼Œpow()ä¸ºPHPä¸­çš„æŒ‡æ•°è¡¨è¾¾å¼ã€‚</li>
<li>æ•´æ•°ç±»å‹æœ‰å¯é€‰çš„UNSIGNEDå±æ€§ï¼Œè¡¨ç¤ºä¸å…è®¸è´Ÿå€¼ï¼Œè¿™å¤§è‡´å¯ä»¥ä½¿æ•´æ•°çš„ä¸Šçº¿æé«˜ä¸€å€ã€‚eg:TINYINT UNSIGENDå¯ä»¥å­˜å‚¨çš„å€¼çš„èŒƒå›´æ˜¯0~255ï¼Œè€Œä¸åŠ UNSIGNEDçš„èŒƒå›´æ˜¯-128~127ã€‚</li>
<li>MySQLå¯ä»¥ä¸ºæ•´æ•°ç±»å‹æŒ‡å®šå®½åº¦ï¼Œä¾‹å¦‚INT(11)ï¼Œå¯¹å¤§å¤šæ•°åº”ç”¨è¿™æ˜¯<strong>æ²¡æœ‰æ„ä¹‰çš„</strong>ï¼šä»–ä¸ä¼šé™åˆ¶å€¼çš„èŒƒå›´ï¼Œåªæ˜¯è§„å®šäº†MySQLçš„ä¸€äº›äº¤äº’å·¥å…·ç”¨æ¥æ˜¾ç¤ºå­—ç¬¦çš„ä¸ªæ•°ã€‚<strong>å¯¹äºå­˜å‚¨å’Œè®¡ç®—æ¥è¯´ï¼ŒINT(1)å’ŒINT(20)æ˜¯ç›¸åŒçš„</strong>ã€‚</li>
</ul>

<h3 id="toc_3">å®æ•°ç±»å‹</h3>

<ul>
<li>å®æ•°æ˜¯å¸¦æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—ã€‚MySQLæ”¯æŒç²¾ç¡®ç±»å‹ï¼Œä¹Ÿæ”¯æŒä¸ç²¾ç¡®ç±»å‹ã€‚</li>
<li><strong>FLOAT</strong> å’Œ <strong>DOUBLE</strong> ç±»å‹æ”¯æŒä½¿ç”¨æ ‡å‡†çš„æµ®ç‚¹è¿ç®—è¿›è¡Œè¿‘ä¼¼è®¡ç®—ã€‚</li>
<li><strong>DECIMAL</strong> ç±»å‹ç”¨äºå­˜å‚¨ç²¾ç¡®çš„å°æ•°ã€‚</li>
<li>æµ®ç‚¹å’ŒDECIMALéƒ½å¯ä»¥æŒ‡å®šç²¾åº¦ã€‚eg:DECIMAL(18,9)å°æ•°ç‚¹ä¸¤è¾¹å°†å„å­˜å‚¨9ä¸ªæ•°å­—ï¼Œä¸€å…±ä½¿ç”¨9ä¸ªå­—èŠ‚ï¼šå°æ•°ç‚¹å‰çš„æ•°å­—ç”¨4ä¸ªå­—èŠ‚ï¼Œå°æ•°ç‚¹åçš„ç”¨4ä¸ªå­—èŠ‚ï¼Œå°æ•°ç‚¹æœ¬èº«ä¸€ä¸ªå­—èŠ‚ã€‚</li>
</ul>

<h3 id="toc_4">å­—ç¬¦ä¸²ç±»å‹</h3>

<h5 id="toc_5">VARCHAR</h5>

<ul>
<li>VARCHAR ç±»å‹ç”¨äºå­˜å‚¨å¯è¾¹é•¿å­—ç¬¦ä¸²ï¼Œæ¯”å®šé•¿ç±»å‹æ›´çœç©ºé—´å› ä¸ºå®ƒä»…ä½¿ç”¨å¿…è¦çš„ç©ºé—´ï¼ˆeg.è¶ŠçŸ­çš„å­—ç¬¦ä¸²ä½¿ç”¨è¶Šå°‘çš„ç©ºé—´ï¼‰ã€‚<strong>æœ‰ä¸€ç§æƒ…å†µä¾‹å¤–</strong>ï¼Œå¦‚æœMySQLè¡¨ä½¿ç”¨ ROW_FORMAT=FIXED åˆ›å»ºçš„è¯ï¼Œæ²¡ä¸€è¡Œéƒ½ä¼šä½¿ç”¨å®šé•¿å­˜å‚¨ï¼Œè¿™å›å¾ˆæµªè´¹ç©ºé—´ã€‚<br/></li>
<li><strong>VARCHARéœ€è¦ä½¿ç”¨1æˆ–2ä¸ªé¢å¤–çš„å­—èŠ‚è®°å½•å­—ç¬¦ä¸²çš„é•¿åº¦ï¼šå¦‚æœåˆ—çš„æœ€å¤§é•¿åº¦å°äºæˆ–ç­‰äº255å­—èŠ‚ï¼Œåˆ™åªä½¿ç”¨1ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œå¦åˆ™ä½¿ç”¨2ä¸ªå­—èŠ‚ã€‚</strong></li>
<li>é€‚åˆä½¿ç”¨VARCHARçš„æƒ…å†µï¼š

<ul>
<li>å­—ç¬¦ä¸²åˆ—çš„æœ€å¤§é•¿åº¦æ¯”å¹³å‡é•¿åº¦å¤§å¾ˆå¤šï¼›</li>
<li>åˆ—çš„æ›´æ–°å°‘ï¼Œæ‰€ä»¥ç¢ç‰‡ä¸æ˜¯é—®é¢˜ï¼›</li>
<li>ä½¿ç”¨äº†åƒUTF-8å¤æ‚çš„å­—ç¬¦é›†ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨ä¸åŒçš„å­—èŠ‚æ•°è¿›è¡Œå­˜å‚¨ã€‚</li>
</ul></li>
</ul>

<h5 id="toc_6">CHAR</h5>

<ul>
<li>CHAR é€‚åˆå­˜å‚¨å¾ˆçŸ­çš„å­—ç¬¦ä¸²</li>
<li>å¯¹äºç»å¸¸å˜æ›´çš„æ•°æ®ï¼ŒCHARä¹Ÿæ¯”VARCHARæ›´å¥½ï¼Œå› ä¸ºè®¢å•çš„CHARç±»å‹ä¸å®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼›</li>
<li>å¯¹äºéå¸¸çŸ­çš„åˆ—ï¼ŒCHARæ¯”VARCHARåœ¨å­˜å‚¨ç©ºé—´ä¸Šä¹Ÿæ›´æœ‰æ•ˆç‡ã€‚</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="14812057029455.html" itemprop="url">
		å‡½æ•°-PHPä¸‹è½½æ–‡ä»¶</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<pre><code class="language-php">function dl_file($file){

   //First, see if the file exists
   if (!is_file($file)) { die(&quot;&lt;b&gt;404 File not found!&lt;/b&gt;&quot;); }

   //Gather relevent info about file
   $len = filesize($file);
   $filename = basename($file);
   $file_extension = strtolower(substr(strrchr($filename,&quot;.&quot;),1));

   //This will set the Content-Type to the appropriate setting for the file
  switch( $file_extension ) {
     case &quot;pdf&quot;: $ctype=&quot;application/pdf&quot;; break;
     case &quot;exe&quot;: $ctype=&quot;application/octet-stream&quot;; break;
     case &quot;zip&quot;: $ctype=&quot;application/zip&quot;; break;
     case &quot;doc&quot;: $ctype=&quot;application/msword&quot;; break;
     case &quot;xls&quot;: $ctype=&quot;application/vnd.ms-excel&quot;; break;
     case &quot;ppt&quot;: $ctype=&quot;application/vnd.ms-powerpoint&quot;; break;
     case &quot;gif&quot;: $ctype=&quot;image/gif&quot;; break;
     case &quot;png&quot;: $ctype=&quot;image/png&quot;; break;
     case &quot;jpeg&quot;:
     case &quot;jpg&quot;: $ctype=&quot;image/jpg&quot;; break;
     case &quot;mp3&quot;: $ctype=&quot;audio/mpeg&quot;; break;
     case &quot;wav&quot;: $ctype=&quot;audio/x-wav&quot;; break;
     case &quot;mpeg&quot;:
     case &quot;mpg&quot;:
     case &quot;mpe&quot;: $ctype=&quot;video/mpeg&quot;; break;
     case &quot;mov&quot;: $ctype=&quot;video/quicktime&quot;; break;
     case &quot;avi&quot;: $ctype=&quot;video/x-msvideo&quot;; break;

     //The following are for extensions that shouldn&#39;t be downloaded (sensitive stuff, like php files)
     case &quot;php&quot;:
     case &quot;htm&quot;:
     case &quot;html&quot;:
     case &quot;txt&quot;: die(&quot;&lt;b&gt;Cannot be used for &quot;. $file_extension .&quot; files!&lt;/b&gt;&quot;); break;

     default: $ctype=&quot;application/force-download&quot;;
   }

   //Begin writing headers
   header(&quot;Pragma: public&quot;);
   header(&quot;Expires: 0&quot;);
   header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);
   header(&quot;Cache-Control: public&quot;);
   header(&quot;Content-Description: File Transfer&quot;);

   //Use the switch-generated Content-Type
   header(&quot;Content-Type: $ctype&quot;);

   //Force the download
   $header=&quot;Content-Disposition: attachment; filename=&quot;.$filename.&quot;;&quot;;
   header($header );
   header(&quot;Content-Transfer-Encoding: binary&quot;);
   header(&quot;Content-Length: &quot;.$len);
   @readfile($file);
   exit;
}
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='fontend.html'>fontend</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="14812057029484.html" itemprop="url">
		Javascript æ­£åˆ™æ¨¡æ¿æ›¿æ¢ä»£ç </a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<pre><code class="language-javascript">function sub(str,data) {
    return str
        .replace(/{(.*?)}/igm,function($,$1) {
            return data[$1]?data[$1]:$;
        });
}
var json=[
    {
        name:&quot;Jim&quot;,
        blog:&quot;jim.com&quot;
    },
    {
        name:&quot;Tom&quot;,
        blog:&quot;tom.com&quot;
    },
    {
        name:&quot;Sam&quot;,
        blog:&quot;saam.com&quot;
    },
];

var tpl=&#39;{name} (blog: {blog})&#39;,
    html = &#39;&#39;;
for(var i = 0;i&lt;json.length;i++) {
    html += sub(tpl,json[i]);
}

console.log(html);
</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql-3.html" itemprop="url">
		ä¼˜åŒ–MySQLåˆ†é¡µ</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>ä¹‹å‰å†™çš„SQLæŸ¥è¯¢è¯­å¥æ ¹æœ¬æ²¡æœ‰è€ƒè™‘åˆ°æ€§èƒ½æ–¹é¢çš„é—®é¢˜ï¼Œä¸€æ˜¯è‡ªå·±æ²¡æœ‰ç»éªŒï¼ŒäºŒæ˜¯å› ä¸ºç½‘ç«™è§„æ¨¡å°æ•°æ®é‡ä¸å¤§ï¼Œè‡ªç„¶æ„Ÿå—ä¸åˆ°æŸ¥è¯¢å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p>

<p>æœ€è¿‘ç”±äºæ•°æ®é‡å¼€å§‹çœŸå¤§ï¼Œåœ¨å¤§åå°ä¸€ä¸ªäº§å“åˆ—è¡¨çš„é¡µé¢å¡ä½äº†å¥½ä¹…ã€‚æœ€è¿‘ä¹Ÿåœ¨é˜…è¯»ã€Šé«˜æ€§èƒ½MYSQLã€‹ï¼Œå°±è§‰å¾—å°†æŸ¥è¯¢çš„è¯­å¥ä¼˜åŒ–ä¸‹ã€‚åºŸè¯ç»“æŸã€‚</p>

<hr/>

<ul>
<li><p>ä¼ ç»Ÿåˆ†é¡µï¼š</p>

<ul>
<li>SELECT * FROM table LIMIT 100000,10</li>
</ul></li>
<li><p>LIMITçš„åŸç†ï¼š</p>

<ul>
<li>LIMIT åç§»é‡ï¼Œæ¡æ•°</li>
<li>å½“åç§»é‡è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢ã€‚</li>
</ul></li>
<li><p>æ¨èæ–¹æ³•ï¼š</p>

<ul>
<li>SELECT * FROM table WHERE id&gt;=100000 LIMIT 11 #10+1 (æ¯é¡µ10æ¡);</li>
<li>SELECT * FROM table INNER JOIN (SELECT id FROM table LIMIT 100000,10) AS t USING(id);</li>
<li>SELECT * FROM table WHERE id&gt;=(SELECT id FROM table LIMIT 100000,1) LIMIT 10; </li>
<li>SELECT id FROM table LIMIT 100000,10;
SELECT * FROM table WHERE id IN(100,101...,110);</li>
</ul></li>
<li><p>å…¶ä»–ï¼š</p>

<ul>
<li>å°½é‡ä¸ç”¨SELECT * ï¼Œåªå–éœ€è¦æ•°æ®åˆ— 

<ul>
<li>æ›´å®‰å…¨çš„è®¾è®¡ï¼šå‡å°‘è¡¨å˜åŒ–å¸¦æ¥çš„å½±å“</li>
<li><strong>ä¸ºä½¿ç”¨covering indexæä¾›å¯èƒ½æ€§</strong></li>
<li>Select/JOINå‡å°‘ç¡¬ç›˜ä¸´æ—¶è¡¨ç”Ÿæˆï¼Œç‰¹åˆ«æ˜¯æœ‰TEXT/BLOBæ—¶</li>
</ul></li>
</ul></li>
</ul>

<p>å‚è€ƒï¼š<br/>
0.MySQLæ•°æ®åº“å¼€å‘çš„ä¸‰åå…­æ¡å†›è§„_çŸ³å±•_å®Œæ•´.pdf<br/>
1.<a href="http://blog.chinaunix.net/uid-26602509-id-3363512.html">**mysql LIMIT å­å¥ç”¨æ³•åŠåŸç† **</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:01:42+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql-iptable.html" itemprop="url">
		MySQLä¸»ä»ï¼ä»åº“å¼€å¯iptablsæ— æ³•åŒæ­¥</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>ä¸‹ç­çš„æ—¶å€™æ£€æŸ¥æ•°æ®åº“ä»æœåŠ¡å™¨å‘ç°æ²¡æœ‰è¿è¡ŒiptablesæœåŠ¡ï¼Œäºæ˜¯é…ç½®äº†æœ‰ç”¨åˆ°çš„ç«¯å£åå¼€å¯äº†iptablesã€‚<br/>
åˆ°å®¶åæœ‰å®¢æœäººå‘˜ååº”æœ‰è®¢å•æŸ¥ä¸åˆ°ï¼Œç¬¬ä¸€ååº”æ˜¯ä¸»ä»åŒæ­¥æ˜¯å¤±è´¥äº†ï¼Œç«‹å³å¼€æœºæ£€æŸ¥ã€‚<br/>
<code>show slave status</code>,å‘ç°æ˜¯æ­£å¸¸çš„ï¼Œæ‰€ä»¥æƒ³åˆ°äº†iptablesï¼Œè¯•ç€æŠŠiptableå…³äº†ï¼Œè¿‡äº†ä¸€ä¼šæ•°æ®åˆåŒæ­¥äº†ã€‚<br/>
å®šä½åˆ°é—®é¢˜çš„æ‰€åœ¨ï¼Œå°±å®¹æ˜“è§£å†³äº†ï¼š<br/>
é…ç½®iptablesï¼Œ</p>

<pre><code class="language-shell"># vim /etc/sysconfig/iptables
-A OUTPUT -p tcp -m tcp --dport 3306 -j ACCEPT
</code></pre>

<p>é‡å¯iptablesæœåŠ¡åæ­£å¸¸ã€‚</p>

<p>å‚è€ƒï¼š<br/>
<a href="http://www.cnblogs.com/JemBai/archive/2009/03/19/1416364.html">linuxä¸‹IPTABLESé…ç½®è¯¦è§£</a></p>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-12-08T22:00:45+08:00" itemprop="datePublished">2016/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="mysql56-install.html" itemprop="url">
		ç¼–è¯‘å®‰è£…MySQL5.6</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h3 id="toc_0">å®‰è£…ç¼–è¯‘ä»£ç éœ€è¦çš„åŒ…</h3>

<pre><code class="language-shell">yum -y install make gcc-c++ cmake bison-devel  ncurses-devel
</code></pre>

<h3 id="toc_1">ä¸‹è½½MySQL 5.6.14</h3>

<pre><code class="language-shell">wget http://cdn.mysql.com/Downloads/MySQL-5.6/mysql-5.6.14.tar.gz
tar xvf mysql-5.6.14.tar.gz
cd mysql-5.6.14
</code></pre>

<h3 id="toc_2">ç¼–è¯‘å®‰è£…</h3>

<blockquote>
<p>ç¼–è¯‘çš„å‚æ•°å¯ä»¥å‚è€ƒ<a href="http://dev.mysql.com/doc/refman/5.5/en/source-configuration-options.html%E3%80%82">http://dev.mysql.com/doc/refman/5.5/en/source-configuration-options.htmlã€‚</a></p>
</blockquote>

<pre><code class="language-shell">cmake \
-DCMAKE_INSTALL_PREFIX=/usr/local/mysql \
-DMYSQL_DATADIR=/usr/local/mysql/data \
-DSYSCONFDIR=/etc \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \
-DWITH_READLINE=1 \
-DMYSQL_UNIX_ADDR=/var/lib/mysql/mysql.sock \
-DMYSQL_TCP_PORT=3306 \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_PARTITION_STORAGE_ENGINE=1 \
-DEXTRA_CHARSETS=all \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci

make &amp;&amp; make install
</code></pre>

<p>æ•´ä¸ªè¿‡ç¨‹éœ€è¦30åˆ†é’Ÿå·¦å³â€¦â€¦æ¼«é•¿çš„ç­‰å¾…</p>

<h3 id="toc_3">é…ç½®MySQL</h3>

<h4 id="toc_4">è®¾ç½®æƒé™</h4>

<p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æœ‰mysqlç”¨æˆ·åŠç”¨æˆ·ç»„</p>

<pre><code class="language-shell">cat /etc/passwd #æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨
cat /etc/group  #æŸ¥çœ‹ç”¨æˆ·ç»„åˆ—è¡¨

groupadd mysql
useradd -g mysql mysql
# ä¿®æ”¹/usr/local/mysqlæƒé™

chown -R mysql:mysql /usr/local/mysql
# ä¿®æ”¹/usr/local/mysqlæƒé™

</code></pre>

<h4 id="toc_5">åˆå§‹åŒ–é…ç½®</h4>

<p>è¿›å…¥å®‰è£…è·¯å¾„</p>

<p><code>cd /usr/local/mysql</code><br/>
è¿›å…¥å®‰è£…è·¯å¾„ï¼Œæ‰§è¡Œåˆå§‹åŒ–é…ç½®è„šæœ¬ï¼Œåˆ›å»ºç³»ç»Ÿè‡ªå¸¦çš„æ•°æ®åº“å’Œè¡¨</p>

<p><code>scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --user=mysql</code></p>

<blockquote>
<p>æ³¨ï¼šåœ¨å¯åŠ¨MySQLæœåŠ¡æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šæ¬¡åºæœç´¢my.cnfï¼Œå…ˆåœ¨/etcç›®å½•ä¸‹æ‰¾ï¼Œæ‰¾ä¸åˆ°åˆ™ä¼šæœç´¢&quot;$basedir/my.cnf&quot;ï¼Œåœ¨æœ¬ä¾‹ä¸­å°±æ˜¯ /usr/local/mysql/my.cnfï¼Œè¿™æ˜¯æ–°ç‰ˆMySQLçš„é…ç½®æ–‡ä»¶çš„é»˜è®¤ä½ç½®ï¼</p>
</blockquote>

<p><strong>æ³¨æ„ï¼šåœ¨CentOS 6.4ç‰ˆæ“ä½œç³»ç»Ÿçš„æœ€å°å®‰è£…å®Œæˆåï¼Œåœ¨/etcç›®å½•ä¸‹ä¼šå­˜åœ¨ä¸€ä¸ªmy.cnfï¼Œéœ€è¦å°†æ­¤æ–‡ä»¶æ›´åä¸ºå…¶ä»–çš„åå­—ï¼Œå¦‚ï¼š/etc/my.cnf.bakï¼Œå¦åˆ™ï¼Œè¯¥æ–‡ä»¶ä¼šå¹²æ‰°æºç å®‰è£…çš„MySQLçš„æ­£ç¡®é…ç½®ï¼Œé€ æˆæ— æ³•å¯åŠ¨ã€‚</strong></p>

<p>åœ¨ä½¿ç”¨&quot;yum update&quot;æ›´æ–°ç³»ç»Ÿåï¼Œéœ€è¦æ£€æŸ¥ä¸‹/etcç›®å½•ä¸‹æ˜¯å¦ä¼šå¤šå‡ºä¸€ä¸ªmy.cnfï¼Œå¦‚æœå¤šå‡ºï¼Œå°†å®ƒé‡å‘½åæˆåˆ«çš„ã€‚å¦åˆ™ï¼ŒMySQLå°†ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œå¯èƒ½é€ æˆæ— æ³•æ­£å¸¸å¯åŠ¨ç­‰é—®é¢˜ã€‚</p>

<p>å¯åŠ¨MySQL</p>

<ul>
<li>æ·»åŠ æœåŠ¡ï¼Œæ‹·è´æœåŠ¡è„šæœ¬åˆ°init.dç›®å½•ï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</li>
</ul>

<pre><code class="language-shell">cp support-files/mysql.server /etc/init.d/mysql
chkconfig mysql on
service mysql start  #å¯åŠ¨MySQL
</code></pre>

<ul>
<li>é…ç½®ç”¨æˆ·</li>
</ul>

<p>MySQLå¯åŠ¨æˆåŠŸåï¼Œrooté»˜è®¤æ²¡æœ‰å¯†ç ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®rootå¯†ç ã€‚</p>

<p>è®¾ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¾ç½®PATHï¼Œè¦ä¸ä¸èƒ½ç›´æ¥è°ƒç”¨mysql</p>

<p>ä¿®æ”¹<code>/etc/profile</code>æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ </p>

<pre><code class="language-shell">PATH=/usr/local/mysql/bin:$PATH
export PATH
</code></pre>

<p>å…³é—­æ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®©é…ç½®ç«‹å³ç”Ÿæ•ˆ</p>

<p><code>source /etc/profile</code><br/>
ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯å†…ç›´æ¥è¾“å…¥mysqlè¿›å…¥ï¼Œmysqlçš„ç¯å¢ƒäº†</p>

<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¿®æ”¹rootå¯†ç </p>

<pre><code class="language-shell">mysql -uroot  
mysql&gt; SET PASSWORD = PASSWORD(&#39;123456&#39;);
</code></pre>

<p>è‹¥è¦è®¾ç½®rootç”¨æˆ·å¯ä»¥è¿œç¨‹è®¿é—®ï¼Œæ‰§è¡Œ</p>

<pre><code class="language-mysql&gt;">passwordä¸ºè¿œç¨‹è®¿é—®æ—¶ï¼Œrootç”¨æˆ·çš„å¯†ç ï¼Œå¯ä»¥å’Œæœ¬åœ°ä¸åŒã€‚

- é…ç½®é˜²ç«å¢™

é˜²ç«å¢™çš„3306ç«¯å£é»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œè‹¥è¦è¿œç¨‹è®¿é—®ï¼Œéœ€è¦å¼€å¯è¿™ä¸ªç«¯å£

æ‰“å¼€`/etc/sysconfig/iptables`

åœ¨`-A INPUT â€“m state --state NEW â€“m tcp â€“p â€“dport 22 â€“j ACCEPT`ï¼Œä¸‹æ·»åŠ ï¼š

`-A INPUT -m state --state NEW -m tcp -p -dport 3306 -j ACCEPT`
ç„¶åä¿å­˜ï¼Œå¹¶å…³é—­è¯¥æ–‡ä»¶ï¼Œåœ¨ç»ˆç«¯å†…è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ·æ–°é˜²ç«å¢™é…ç½®ï¼š

`service iptables restart`

OKï¼Œä¸€åˆ‡é…ç½®å®Œæ¯•ï¼Œä½ å¯ä»¥è®¿é—®ä½ çš„MySQLäº†~

------------------------------------------------------------------------------------------------------------------

CentOS 7ä¸­é»˜è®¤ä½¿ç”¨Firewalldåšé˜²ç«å¢™ï¼Œæ‰€ä»¥ä¿®æ”¹iptablesåï¼Œåœ¨é‡å¯ç³»ç»Ÿåï¼Œæ ¹æœ¬ä¸ç®¡ç”¨ã€‚

Firewalldä¸­æ·»åŠ ç«¯å£æ–¹æ³•å¦‚ä¸‹ï¼š

firewall-cmd --zone=public --add-port=3306/tcp --permanent

firewall-cmd --reload


</code></pre>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-11-22T22:01:42+08:00" itemprop="datePublished">2016/11/22</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="supervisor-redis.html" itemprop="url">
		ä½¿ç”¨supervisorå¯åŠ¨redisæœåŠ¡</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2 id="toc_0">ç¼˜èµ·</h2>

<p>åœ¨æœåŠ¡å™¨æ²¡æœ‰ä¼˜åŒ–å‰ï¼ŒWebæœåŠ¡å’ŒRedisæœåŠ¡æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œæœ‰ä¸€æ¬¡ç³»ç»Ÿé‡åˆ°å¼‚å¸¸ï¼Œå¯¼è‡´Redisè¿›ç¨‹è¢«å¹²æ‰äº†ã€‚<br/>
å› ä¸ºSessionæ˜¯ç”¨Rediså­˜å‚¨çš„ï¼Œç»“æœå¯¼è‡´ç½‘ç«™æ— æ³•ç™»å½•ã€‚ï¼ˆåæ¥æŸ¥äº†/var/log/message,å‘ç°æ˜¯å†…å­˜ä¸å¤Ÿï¼Œç³»ç»Ÿè‡ªåŠ¨æ€æ­»äº†è€—å†…å­˜çš„è¿›ç¨‹ï¼Œè¿crontabæœåŠ¡ä¹Ÿæ­»äº†ğŸ˜¢ã€‚<br/>
ä¼˜åŒ–çš„æ–¹æ¡ˆæ˜¯æŠŠRedisæœåŠ¡ç‹¬ç«‹ä¸€å°æœåŠ¡å™¨ï¼Œè€Œä¸”åšäº†ä¸»ä»ã€‚ä¹‹åæœåŠ¡ç¨³å®šè¿è¡Œã€‚<br/>
ä¸å¤Ÿä¸€ç›´ä¸è§£çš„é—®é¢˜æ˜¯ï¼ŒRedisé…ç½®çš„å†…å­˜æ˜¯512Mï¼Œä¸åº”è¯¥å†…å­˜ä¸å¤Ÿç”¨çš„ï¼ŒWebæœåŠ¡ç”¨çš„å†…å­˜ä¹Ÿä¸å¤šï¼Œæ— è§£ã€‚</p>

<h2 id="toc_1">é…ç½®</h2>

<ul>
<li><p>å®‰è£…supervisor</p>

<ul>
<li><code>yum install python-setuptools</code></li>
<li><code>easy_install supervisor</code></li>
<li><code>supervisord -c /etc/supervisord.conf</code></li>
<li><code>vim /etc/supervisord.conf</code>ï¼Œé…ç½®è¯»å–çš„é…ç½®æ–‡ä»¶ä½ç½®<code>[include]</code>ï¼Œä¿®æ”¹ï¼š<code>files = /etc/supervisord/*.conf</code></li>
</ul></li>
<li><p>æ·»åŠ Redisé…ç½®</p></li>
</ul>

<pre><code class="language-shell">[program:redis]
command = /opt/redis-3.0.7/src/redis-server  /opt/redis-3.0.7/redis-6679.conf
autostart=true
autorestart=true
startsecs=3
</code></pre>

<ul>
<li><p>å¦‚æœæŠ¥é”™å¦‚ä¸‹<br/>
<code>shell<br/>
gave up: redis entered FATAL state, too many start retries too quickly<br/>
ä¿®æ”¹redis.confçš„daemonizeä¸ºno<br/>
</code></p></li>
<li><p>å¯åŠ¨<code>supervisord -c /etc/supervisord.conf</code></p></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-11-08T22:01:42+08:00" itemprop="datePublished">2016/11/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="telegraf-infuxdb.html" itemprop="url">
		åŸºäºtelegrafï¼‹inlfuxDBæ­å»ºæ—¥å¿—æ”¶é›†ç³»ç»Ÿ</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h2 id="toc_0">ä»‹ç»</h2>

<ul>
<li><p>InfluxDB</p>

<blockquote>
<p><a href="https://www.influxdata.com/">InfluxDB</a>ç”¨Goè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œå’Œä¼ ç»Ÿæ˜¯æ•°æ®åº“ç›¸æ¯”æœ‰ä¸å°‘ä¸åŒçš„åœ°æ–¹ã€‚<br/>
ç±»ä¼¼çš„æ•°æ®åº“æœ‰Elasticsearchã€Graphiteç­‰ã€‚</p>
</blockquote></li>
<li><p>telegraf</p>

<blockquote>
<p>Telegraf æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„ä»£ç†ç¨‹åºï¼Œå¯æ”¶é›†ç³»ç»Ÿå’ŒæœåŠ¡çš„ç»Ÿè®¡æ•°æ®ï¼Œå¹¶å†™å…¥åˆ° InfluxDB æ•°æ®åº“ã€‚<br/>
Telegraf å…·æœ‰å†…å­˜å ç”¨å°çš„ç‰¹ç‚¹ï¼Œé€šè¿‡æ’ä»¶ç³»ç»Ÿå¼€å‘äººå‘˜å¯è½»æ¾æ·»åŠ æ”¯æŒå…¶ä»–æœåŠ¡çš„æ‰©å±•ã€‚</p>
</blockquote></li>
</ul>

<h2 id="toc_1">å®‰è£…</h2>

<pre><code class="language-bash"># å®‰è£…influxDB
wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.0.x86_64.rpm
sudo yum localinstall influxdb-1.0.0.x86_64.rpm
# å®‰è£…telegraf
wget https://dl.influxdata.com/telegraf/releases/telegraf-1.0.0.x86_64.rpm
sudo yum localinstall telegraf-1.0.0.x86_64.rpm
</code></pre>

<p>å®‰è£…å¥½åé…ç½®æ–‡ä»¶åˆ†åˆ«åœ¨ <code>/etc/influxdb/</code>,<code>/etc/telegraf</code>ä¸‹</p>

<h2 id="toc_2">ä¿®æ”¹telegrafé…ç½®æ–‡ä»¶</h2>

<p><code>vim /etc/telegraf/telegraf.conf</code></p>

<pre><code class="language-bash"># è¿™é‡Œé…ç½®æ”¶é›†æ—¥è‡³è§„åˆ™,å¦‚æœæ—¥å¿—æ ¼å¼ä¸åŒå¯ä»¥é…ç½®å¤šé¡¹
[[inputs.logparser]]
    files = [&quot;/var/log/test/tmp.log&quot;]
    from_beginning = true
    [inputs.logparser.grok]
         # grok patternsï¼Œå¯ä»¥å‚è€ƒlogstashçš„grok
         patterns = [&quot;%{DATA:date} %{IPV4:ip} %{HOSTNAME:client} %{WORD:method}#%{PARAMS:params}&quot;]
         # ä¸Šé¢çš„è§„åˆ™åŒ¹é…å¦‚ä¸‹æ—¥å¿—
         # 2016-09-11 10:59:03 127.0.0.1 localhost Order_Globle_Search#sid:,mid:,lid:,tid:,ltitle:,ttitle:,btime1:,etime1:,btime2:,etime2:,btime3:,etime3:,ordernum:6605350,oname:,otel:,s    tatus:,pays:,fromt:,orderby:1,sort:0,rstart:0,n:1,c:,ordermode:,payinfo:,pmode:

        # ç±»ä¼¼äºæ•°æ®åº“çš„tableåç§°
        measurement = &quot;soap_log&quot;
         # è¿™é‡Œå®šä¹‰è‡ªå®šä¹‰åŒ¹é…è§„åˆ™ï¼Œæ ¼å¼: å˜é‡å æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯è¡Œä¸€ä¸ªè§„åˆ™
        custom_patterns = &#39;&#39;&#39;
            PARAMS .*
        &#39;&#39;&#39;
 [[inputs.logparser]]
   files = [&quot;/var/log/test/tmp.log&quot;]
   from_beginning = true
     # nginx è®¿é—®æ—¥å¿—æ ¼å¼
     patterns = [&quot;%{COMMON_LOG_FORMAT}&quot;]
      # è‡ªå®šä¹‰åŒ¹é…æ ¼å¼ä¿å­˜çš„æ–‡ä»¶ä½ç½®
     custom_pattern_files = []
     ## Custom patterns can also be defined here. Put one pattern per line.
     custom_patterns = &#39;&#39;&#39;
        PARAMS .*
     &#39;&#39;&#39;

</code></pre>

<h2 id="toc_3">å¯åŠ¨</h2>

<pre><code class="language-bash">service influxdb start
service telegraf start
</code></pre>

<p>æ‰“å¼€influxdbçš„webåå°åœ°å€(é»˜è®¤ç«¯å£æ˜¯8083)ï¼Œé€‰æ‹©æ•°æ®åº“ telegrafï¼Œæ‰§è¡Œ<code>show measurements</code> ,å¯ä»¥æŸ¥çœ‹å·²æœ‰çš„è¡¨ã€‚å¦‚æœé…ç½®æ–‡ä»¶åªä¿®æ”¹äº†<code>logparser</code> ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥çœ‹åˆ°cpuï¼Œdiskç­‰ä¸€äº›ä¸ç³»ç»Ÿç›¸å…³çš„è¡¨ï¼Œè¿™ä¹Ÿæ˜¯telegrafæ”¶é›†çš„æ•°æ®ã€‚</p>

<h2 id="toc_4">å¸¸ç”¨çš„æŸ¥è¯¢è¯­å¥</h2>

<ul>
<li>æ ¹æ®å­—æ®µåç§°æŸ¥è¯¢ï¼š<code>select * from test_access_log where words=~ /Dynamic_Price_And_Storage/</code></li>
<li>åˆ é™¤è¡¨:<code>drop MEASUREMENTS test_access_log</code></li>
<li># åŸºäºtelegrafï¼‹inlfuxDBæ­å»ºæ—¥å¿—æ”¶é›†ç³»ç»Ÿ</li>
</ul>

<h2 id="toc_5">ä»‹ç»</h2>

<ul>
<li><p>InfluxDB</p>

<blockquote>
<p><a href="https://www.influxdata.com/">InfluxDB</a>ç”¨Goè¯­è¨€ç¼–å†™çš„ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“ï¼Œå’Œä¼ ç»Ÿæ˜¯æ•°æ®åº“ç›¸æ¯”æœ‰ä¸å°‘ä¸åŒçš„åœ°æ–¹ã€‚<br/>
ç±»ä¼¼çš„æ•°æ®åº“æœ‰Elasticsearchã€Graphiteç­‰ã€‚</p>
</blockquote></li>
<li><p>telegraf</p>

<blockquote>
<p>Telegraf æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„ä»£ç†ç¨‹åºï¼Œå¯æ”¶é›†ç³»ç»Ÿå’ŒæœåŠ¡çš„ç»Ÿè®¡æ•°æ®ï¼Œå¹¶å†™å…¥åˆ° InfluxDB æ•°æ®åº“ã€‚<br/>
Telegraf å…·æœ‰å†…å­˜å ç”¨å°çš„ç‰¹ç‚¹ï¼Œé€šè¿‡æ’ä»¶ç³»ç»Ÿå¼€å‘äººå‘˜å¯è½»æ¾æ·»åŠ æ”¯æŒå…¶ä»–æœåŠ¡çš„æ‰©å±•ã€‚</p>
</blockquote></li>
</ul>

<h2 id="toc_6">å®‰è£…</h2>

<pre><code class="language-bash"># å®‰è£…influxDB
wget https://dl.influxdata.com/influxdb/releases/influxdb-1.0.0.x86_64.rpm
sudo yum localinstall influxdb-1.0.0.x86_64.rpm
# å®‰è£…telegraf
wget https://dl.influxdata.com/telegraf/releases/telegraf-1.0.0.x86_64.rpm
sudo yum localinstall telegraf-1.0.0.x86_64.rpm
</code></pre>

<p>å®‰è£…å¥½åé…ç½®æ–‡ä»¶åˆ†åˆ«åœ¨ <code>/etc/influxdb/</code>,<code>/etc/telegraf</code>ä¸‹</p>

<h2 id="toc_7">ä¿®æ”¹telegrafé…ç½®æ–‡ä»¶</h2>

<p><code>vim /etc/telegraf/telegraf.conf</code></p>

<pre><code class="language-bash"># è¿™é‡Œé…ç½®æ”¶é›†æ—¥è‡³è§„åˆ™,å¦‚æœæ—¥å¿—æ ¼å¼ä¸åŒå¯ä»¥é…ç½®å¤šé¡¹
[[inputs.logparser]]
    files = [&quot;/var/log/test/tmp.log&quot;]
    from_beginning = true
    [inputs.logparser.grok]
         # grok patternsï¼Œå¯ä»¥å‚è€ƒlogstashçš„grok
         patterns = [&quot;%{DATA:date} %{IPV4:ip} %{HOSTNAME:client} %{WORD:method}#%{PARAMS:params}&quot;]
         # ä¸Šé¢çš„è§„åˆ™åŒ¹é…å¦‚ä¸‹æ—¥å¿—
         # 2016-09-11 10:59:03 127.0.0.1 localhost Order_Globle_Search#sid:,mid:,lid:,tid:,ltitle:,ttitle:,btime1:,etime1:,btime2:,etime2:,btime3:,etime3:,ordernum:6605350,oname:,otel:,s    tatus:,pays:,fromt:,orderby:1,sort:0,rstart:0,n:1,c:,ordermode:,payinfo:,pmode:

        # ç±»ä¼¼äºæ•°æ®åº“çš„tableåç§°
        measurement = &quot;soap_log&quot;
         # è¿™é‡Œå®šä¹‰è‡ªå®šä¹‰åŒ¹é…è§„åˆ™ï¼Œæ ¼å¼: å˜é‡å æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯è¡Œä¸€ä¸ªè§„åˆ™
        custom_patterns = &#39;&#39;&#39;
            PARAMS .*
        &#39;&#39;&#39;
 [[inputs.logparser]]
   files = [&quot;/var/log/test/tmp.log&quot;]
   from_beginning = true
     # nginx è®¿é—®æ—¥å¿—æ ¼å¼
     patterns = [&quot;%{COMMON_LOG_FORMAT}&quot;]
      # è‡ªå®šä¹‰åŒ¹é…æ ¼å¼ä¿å­˜çš„æ–‡ä»¶ä½ç½®
     custom_pattern_files = []
     ## Custom patterns can also be defined here. Put one pattern per line.
     custom_patterns = &#39;&#39;&#39;
        PARAMS .*
     &#39;&#39;&#39;

</code></pre>

<h2 id="toc_8">å¯åŠ¨</h2>

<pre><code class="language-bash">service influxdb start
service telegraf start
</code></pre>

<p>æ‰“å¼€influxdbçš„webåå°åœ°å€(é»˜è®¤ç«¯å£æ˜¯8083)ï¼Œé€‰æ‹©æ•°æ®åº“ telegrafï¼Œæ‰§è¡Œ<code>show measurements</code> ,å¯ä»¥æŸ¥çœ‹å·²æœ‰çš„è¡¨ã€‚å¦‚æœé…ç½®æ–‡ä»¶åªä¿®æ”¹äº†<code>logparser</code> ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥çœ‹åˆ°cpuï¼Œdiskç­‰ä¸€äº›ä¸ç³»ç»Ÿç›¸å…³çš„è¡¨ï¼Œè¿™ä¹Ÿæ˜¯telegrafæ”¶é›†çš„æ•°æ®ã€‚</p>

<h2 id="toc_9">å¸¸ç”¨çš„æŸ¥è¯¢è¯­å¥</h2>

<ul>
<li>æ ¹æ®å­—æ®µåç§°æŸ¥è¯¢ï¼š<code>select * from test_access_log where words=~ /Dynamic_Price_And_Storage/</code></li>
<li>åˆ é™¤è¡¨:<code>drop MEASUREMENTS test_access_log</code>
<img src="https://lh3.googleusercontent.com/-aZBC0POMiK0/WE1blywCAPI/AAAAAAAACZc/8ld2Wt15jOg/I/demo.png" alt="demo"/></li>
</ul>

<h2 id="toc_10">å‚è€ƒ</h2>

<ul>
<li><a href="https://segmentfault.com/a/1190000000444617">InfluxDB å¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“</a></li>
<li><a href="http://udn.yyuap.com/doc/logstash-best-practice-cn/filter/grok.html">Grokæ­£åˆ™æ•è·</a></li>
<li><a href="https://github.com/logstash-plugins/logstash-patterns-core/blob/master/patterns/grok-patterns">logstash ç³»ç»Ÿè‡ªå¸¦çš„gropè§„åˆ™(å¯ä»¥ç›´æ¥åœ¨telegrafä¸­ä½¿ç”¨)</a></li>
<li><a href="https://github.com/kkos/oniguruma/blob/master/doc/RE">Oniguruma Regular Expressions Version 6.0.0</a></li>
</ul>

<p><img src="https://lh3.googleusercontent.com/-aZBC0POMiK0/WE1blywCAPI/AAAAAAAACZc/8ld2Wt15jOg/I/demo.png" alt="demo"/></p>

<h2 id="toc_11">å‚è€ƒ</h2>

<ul>
<li><a href="https://segmentfault.com/a/1190000000444617">InfluxDB å¼€æºåˆ†å¸ƒå¼æ—¶åºã€äº‹ä»¶å’ŒæŒ‡æ ‡æ•°æ®åº“</a></li>
<li><a href="http://udn.yyuap.com/doc/logstash-best-practice-cn/filter/grok.html">Grokæ­£åˆ™æ•è·</a></li>
<li><a href="https://github.com/logstash-plugins/logstash-patterns-core/blob/master/patterns/grok-patterns">logstash ç³»ç»Ÿè‡ªå¸¦çš„gropè§„åˆ™(å¯ä»¥ç›´æ¥åœ¨telegrafä¸­ä½¿ç”¨)</a></li>
<li><a href="https://github.com/kkos/oniguruma/blob/master/doc/RE">Oniguruma Regular Expressions Version 6.0.0</a></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2016-05-22T21:01:42+08:00" itemprop="datePublished">2016/5/22</time>
			</div>
			
			 
			
		</div>
		<h1 class="title" itemprop="name"><a href="elasticsearch-basic.html" itemprop="url">
		Elasticsearchå…¥é—¨</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h3 id="toc_0">install plugin</h3>

<ul>
<li><p>head</p>

<pre><code class="language-shell">plugin install mobz/elasticsearch-head  
</code></pre>

<p>â€‹</p></li>
<li><p>kpof</p>

<pre><code class="language-shell">plug install lmenezes/elasticsearch-kopf/master
</code></pre>

<p>â€‹</p></li>
</ul>

<h3 id="toc_1">ä¸ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“å¯¹æ¯”</h3>

<table>
<thead>
<tr>
<th>MySQL</th>
<th>Elasticsearch</th>
</tr>
</thead>

<tbody>
<tr>
<td>Database-æ•°æ®åº“</td>
<td>Indices-ç´¢å¼•</td>
</tr>
<tr>
<td>Tables-è¡¨</td>
<td>Types-ç±»å‹</td>
</tr>
<tr>
<td>Rows-è¡Œ</td>
<td>Documents-æ–‡æ¡£</td>
</tr>
<tr>
<td>Columns-åˆ—</td>
<td>Fields-</td>
</tr>
</tbody>
</table>

<h3 id="toc_2">é…ç½®è¯´æ˜</h3>

<blockquote>
<p>elasticsearchçš„configæ–‡ä»¶å¤¹é‡Œé¢æœ‰ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼šelasticsearch.ymlå’Œlogging.ymlï¼Œç¬¬ä¸€ä¸ªæ˜¯esçš„åŸºæœ¬é…ç½®æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªæ˜¯æ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œesä¹Ÿæ˜¯ä½¿ç”¨log4jæ¥è®°å½•æ—¥å¿—çš„ï¼Œæ‰€ä»¥logging.ymlé‡Œçš„è®¾ç½®æŒ‰æ™®é€šlog4jé…ç½®æ–‡ä»¶æ¥è®¾ç½®å°±è¡Œäº†ã€‚ä¸‹é¢ä¸»è¦è®²è§£ä¸‹elasticsearch.ymlè¿™ä¸ªæ–‡ä»¶ä¸­å¯é…ç½®çš„ä¸œè¥¿ã€‚</p>
</blockquote>

<pre><code class="language-yaml">cluster.name: elasticsearch
#é…ç½®esçš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchï¼Œesä¼šè‡ªåŠ¨å‘ç°åœ¨åŒä¸€ç½‘æ®µä¸‹çš„esï¼Œå¦‚æœåœ¨åŒä¸€ç½‘æ®µä¸‹æœ‰å¤šä¸ªé›†ç¾¤ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªå±æ€§æ¥åŒºåˆ†ä¸åŒçš„é›†ç¾¤ã€‚

node.name: &quot;FranzKafka&quot;
#èŠ‚ç‚¹åï¼Œé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªnameåˆ—è¡¨ä¸­åå­—ï¼Œè¯¥åˆ—è¡¨åœ¨esçš„jaråŒ…ä¸­configæ–‡ä»¶å¤¹é‡Œname.txtæ–‡ä»¶ä¸­ï¼Œå…¶ä¸­æœ‰å¾ˆå¤šä½œè€…æ·»åŠ çš„æœ‰è¶£åå­—ã€‚

node.master: true
#æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰èµ„æ ¼è¢«é€‰ä¸¾æˆä¸ºnodeï¼Œé»˜è®¤æ˜¯trueï¼Œesæ˜¯é»˜è®¤é›†ç¾¤ä¸­çš„ç¬¬ä¸€å°æœºå™¨ä¸ºmasterï¼Œå¦‚æœè¿™å°æœºæŒ‚äº†å°±ä¼šé‡æ–°é€‰ä¸¾masterã€‚

node.data: true
#æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œé»˜è®¤ä¸ºtrueã€‚

index.number_of_shards: 5
#è®¾ç½®é»˜è®¤ç´¢å¼•åˆ†ç‰‡ä¸ªæ•°ï¼Œé»˜è®¤ä¸º5ç‰‡ã€‚

index.number_of_replicas: 1
#è®¾ç½®é»˜è®¤ç´¢å¼•å‰¯æœ¬ä¸ªæ•°ï¼Œé»˜è®¤ä¸º1ä¸ªå‰¯æœ¬ã€‚

path.conf: /path/to/conf
#è®¾ç½®é…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„configæ–‡ä»¶å¤¹ã€‚

path.data: /path/to/data
#è®¾ç½®ç´¢å¼•æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªå­˜å‚¨è·¯å¾„ï¼Œç”¨é€—å·éš”å¼€ï¼Œä¾‹ï¼š
path.data: /path/to/data1,/path/to/data2

path.work: /path/to/work
#è®¾ç½®ä¸´æ—¶æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„workæ–‡ä»¶å¤¹ã€‚

path.logs: /path/to/logs
#è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„logsæ–‡ä»¶å¤¹

path.plugins: /path/to/plugins
#è®¾ç½®æ’ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„pluginsæ–‡ä»¶å¤¹

bootstrap.mlockall: true
#è®¾ç½®ä¸ºtrueæ¥é”ä½å†…å­˜ã€‚å› ä¸ºå½“jvmå¼€å§‹swappingæ—¶esçš„æ•ˆç‡ä¼šé™ä½ï¼Œæ‰€ä»¥è¦ä¿è¯å®ƒä¸swapï¼Œå¯ä»¥æŠŠES_MIN_MEMå’ŒES_MAX_MEMä¸¤ä¸ªç¯å¢ƒå˜é‡è®¾ç½®æˆåŒä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”ä¿è¯æœºå™¨æœ‰è¶³å¤Ÿçš„å†…å­˜åˆ†é…ç»™esã€‚åŒæ—¶ä¹Ÿè¦å…è®¸elasticsearchçš„è¿›ç¨‹å¯ä»¥é”ä½å†…å­˜ï¼Œlinuxä¸‹å¯ä»¥é€šè¿‡`ulimit-l unlimited`å‘½ä»¤ã€‚

network.bind_host: 192.168.0.1
#è®¾ç½®ç»‘å®šçš„ipåœ°å€ï¼Œå¯ä»¥æ˜¯ipv4æˆ–ipv6çš„ï¼Œé»˜è®¤ä¸º0.0.0.0ã€‚


network.publish_host: 192.168.0.1
#è®¾ç½®å…¶å®ƒèŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹äº¤äº’çš„ipåœ°å€ï¼Œå¦‚æœä¸è®¾ç½®å®ƒä¼šè‡ªåŠ¨åˆ¤æ–­ï¼Œå€¼å¿…é¡»æ˜¯ä¸ªçœŸå®çš„ipåœ°å€ã€‚

network.host: 192.168.0.1
#è¿™ä¸ªå‚æ•°æ˜¯ç”¨æ¥åŒæ—¶è®¾ç½®bind_hostå’Œpublish_hostä¸Šé¢ä¸¤ä¸ªå‚æ•°ã€‚

transport.tcp.port: 9300
#è®¾ç½®èŠ‚ç‚¹é—´äº¤äº’çš„tcpç«¯å£ï¼Œé»˜è®¤æ˜¯9300ã€‚

transport.tcp.compress: true
#è®¾ç½®æ˜¯å¦å‹ç¼©tcpä¼ è¾“æ—¶çš„æ•°æ®ï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸å‹ç¼©ã€‚

http.port: 9200
#è®¾ç½®å¯¹å¤–æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ä¸º9200ã€‚

http.max_content_length: 100mb
#è®¾ç½®å†…å®¹çš„æœ€å¤§å®¹é‡ï¼Œé»˜è®¤100mb

http.enabled: false
#æ˜¯å¦ä½¿ç”¨httpåè®®å¯¹å¤–æä¾›æœåŠ¡ï¼Œé»˜è®¤ä¸ºtrueï¼Œå¼€å¯ã€‚

gateway.type: local
#gatewayçš„ç±»å‹ï¼Œé»˜è®¤ä¸ºlocalå³ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå¯ä»¥è®¾ç½®ä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œhadoopçš„HDFSï¼Œå’Œamazonçš„s3æœåŠ¡å™¨ï¼Œå…¶å®ƒæ–‡ä»¶ç³»ç»Ÿçš„è®¾ç½®æ–¹æ³•ä¸‹æ¬¡å†è¯¦ç»†è¯´ã€‚

gateway.recover_after_nodes: 1
#è®¾ç½®é›†ç¾¤ä¸­Nä¸ªèŠ‚ç‚¹å¯åŠ¨æ—¶è¿›è¡Œæ•°æ®æ¢å¤ï¼Œé»˜è®¤ä¸º1ã€‚

gateway.recover_after_time: 5m
#è®¾ç½®åˆå§‹åŒ–æ•°æ®æ¢å¤è¿›ç¨‹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯5åˆ†é’Ÿã€‚

gateway.expected_nodes: 2
#è®¾ç½®è¿™ä¸ªé›†ç¾¤ä¸­èŠ‚ç‚¹çš„æ•°é‡ï¼Œé»˜è®¤ä¸º2ï¼Œä¸€æ—¦è¿™Nä¸ªèŠ‚ç‚¹å¯åŠ¨ï¼Œå°±ä¼šç«‹å³è¿›è¡Œæ•°æ®æ¢å¤ã€‚

cluster.routing.allocation.node_initial_primaries_recoveries: 4
#åˆå§‹åŒ–æ•°æ®æ¢å¤æ—¶ï¼Œå¹¶å‘æ¢å¤çº¿ç¨‹çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º4ã€‚

cluster.routing.allocation.node_concurrent_recoveries: 2
#æ·»åŠ åˆ é™¤èŠ‚ç‚¹æˆ–è´Ÿè½½å‡è¡¡æ—¶å¹¶å‘æ¢å¤çº¿ç¨‹çš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º4ã€‚

indices.recovery.max_size_per_sec: 0
#è®¾ç½®æ•°æ®æ¢å¤æ—¶é™åˆ¶çš„å¸¦å®½ï¼Œå¦‚å…¥100mbï¼Œé»˜è®¤ä¸º0ï¼Œå³æ— é™åˆ¶ã€‚

indices.recovery.concurrent_streams: 5
#è®¾ç½®è¿™ä¸ªå‚æ•°æ¥é™åˆ¶ä»å…¶å®ƒåˆ†ç‰‡æ¢å¤æ•°æ®æ—¶æœ€å¤§åŒæ—¶æ‰“å¼€å¹¶å‘æµçš„ä¸ªæ•°ï¼Œé»˜è®¤ä¸º5ã€‚

discovery.zen.minimum_master_nodes: 1
#è®¾ç½®è¿™ä¸ªå‚æ•°æ¥ä¿è¯é›†ç¾¤ä¸­çš„èŠ‚ç‚¹å¯ä»¥çŸ¥é“å…¶å®ƒNä¸ªæœ‰masterèµ„æ ¼çš„èŠ‚ç‚¹ã€‚é»˜è®¤ä¸º1ï¼Œå¯¹äºå¤§çš„é›†ç¾¤æ¥è¯´ï¼Œå¯ä»¥è®¾ç½®å¤§ä¸€ç‚¹çš„å€¼ï¼ˆ2-4ï¼‰

discovery.zen.ping.timeout:  3s
#è®¾ç½®é›†ç¾¤ä¸­è‡ªåŠ¨å‘ç°å…¶å®ƒèŠ‚ç‚¹æ—¶pingè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º3ç§’ï¼Œå¯¹äºæ¯”è¾ƒå·®çš„ç½‘ç»œç¯å¢ƒå¯ä»¥é«˜ç‚¹çš„å€¼æ¥é˜²æ­¢è‡ªåŠ¨å‘ç°æ—¶å‡ºé”™ã€‚

discovery.zen.ping.multicast.enabled:  false
#è®¾ç½®æ˜¯å¦æ‰“å¼€å¤šæ’­å‘ç°èŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯trueã€‚

discovery.zen.ping.unicast.hosts:  [&quot;host1&quot;, &quot;host2: port&quot;,&quot;host3[portX-portY]&quot;]
#è®¾ç½®é›†ç¾¤ä¸­masterèŠ‚ç‚¹çš„åˆå§‹åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›èŠ‚ç‚¹æ¥è‡ªåŠ¨å‘ç°æ–°åŠ å…¥é›†ç¾¤çš„èŠ‚ç‚¹
</code></pre>

<h3 id="toc_3">é›†ç¾¤æ­å»º</h3>

<ul>
<li><p>es1</p>

<pre><code class="language-yaml">cluster.name: sccES
node.name: &quot;es01&quot;
node.master: true
node.data: true
bootstrap.mlockall: true
network.host: 192.168.1.106
network.publish_host: 192.168.1.106
discovery.zen.ping.unicast.hosts: [&quot;192.168.1.108&quot;]   # å¦‚æœæ²¡æœ‰é…ç½®æ­¤é¡¹ï¼ŒèŠ‚ç‚¹å°†æ— æ³•åŠ å…¥åˆ°master
</code></pre>

<p>â€‹</p></li>
<li><p>es2</p>

<pre><code class="language-yaml">cluster.name: sccES
node.name: &quot;es02&quot;
node.master: false
bootstrap.mlockall: true
network.host: 192.168.1.108
network.publish_host: 192.168.1.108
discovery.zen.ping.unicast.hosts: [&quot;192.168.1.106&quot;]  # å¦‚æœæ²¡æœ‰é…ç½®æ­¤é¡¹ï¼ŒèŠ‚ç‚¹å°†æ— æ³•åŠ å…¥åˆ°master
</code></pre>

<p>â€‹</p></li>
</ul>

<h3 id="toc_4">æŸ¥è¯¢</h3>

<ul>
<li>å¤åˆæŸ¥è¯¢</li>
</ul>

<pre><code class="language-json">{
    &quot;query&quot;:{
        &quot;filtered&quot;:{
            &quot;filter&quot;:{
                 &quot;range&quot;:{
                    &quot;age&quot;:{&quot;gt&quot;:25} /*æ¡ä»¶1ï¼šå¹´é¾„å¤§äº25*/
                }
            },
            &quot;query&quot;:{
                &quot;match&quot;:{
                    &quot;last_name&quot;:&quot;Chen&quot; /*æ¡ä»¶2*/
                }
            }

        }
    }
}
</code></pre>

<ul>
<li><p>å…¨æ–‡æœç´¢</p>

<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchæ ¹æ®ç»“æœç›¸å…³æ€§è¯„åˆ†æ¥å¯¹ç»“æœé›†è¿›è¡Œæ’åºï¼Œæ‰€è°“çš„ã€Œç»“æœç›¸å…³æ€§è¯„åˆ†ã€å°±æ˜¯æ–‡æ¡£ä¸æŸ¥è¯¢æ¡ä»¶çš„åŒ¹é…ç¨‹åº¦</p>
</blockquote>

<pre><code class="language-json">{
&quot;query&quot;:{
    &quot;match&quot;:{
            &quot;abount&quot;: &quot;coding php&quot;
    }
}
}
</code></pre></li>
<li><p>çŸ­è¯­æœç´¢</p>

<pre><code class="language-json">{
  &quot;query&quot;:{
        &quot;match_phrase&quot;:{&quot;about&quot;:&quot;coding php&quot;}
    },
   &quot;highlight&quot;:{/*é«˜äº®æ˜¾ç¤ºï¼Œç”¨&lt;em&gt;&lt;/em&gt;åŒ…è£¹*/
        &quot;fields&quot;:{
            &quot;about&quot;:{}
        }
    }
}
</code></pre></li>
<li><p>èšåˆ(group by)</p>

<pre><code class="language-json">/*ç»Ÿè®¡Liçš„æ‰€æœ‰å…´è¶£*/
{
  &quot;query&quot;:{
      &quot;match&quot;:{
          &quot;last_name&quot;:&quot;Li&quot;
      }
  },
  &quot;aggs&quot;:{
      &quot;all_interests&quot;:{
          &quot;terms&quot;:{&quot;field&quot;:&quot;interests&quot;}
      }
  }
}
/*ç»Ÿè®¡æ¯ç§å…´è¶£ä¸‹èŒå‘˜çš„å¹³å‡å¹´é¾„*/
{
  &quot;aggs&quot;:{
      &quot;all_interests&quot;:{
          &quot;terms&quot;:{&quot;field&quot;:&quot;interests&quot;},
          &quot;aggs&quot;:{
              &quot;avg_age&quot;:{
                  &quot;avg&quot;:{&quot;field&quot;:&quot;age&quot;}
              }
          }
      }
  }
}
</code></pre>

<p>â€‹</p></li>
</ul>

<h3 id="toc_5">å‚è€ƒèµ„æ–™</h3>

<ul>
<li><a href="http://es.xiaoleilu.com/index.html">Elasticsearch æƒå¨æŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰</a></li>
<li><a href="https://www.gitbook.com/book/endymecy/elasticsearch-guide-chinese/details">elasticsearchä¸­æ–‡æŒ‡å—</a></li>
<li><a href="https://www.gitbook.com/book/pengqiuyuan/elkbook/details">æ—¥å¿—æ”¶é›†ä¸åˆ†æéƒ¨ç½²</a></li>
<li><a href="http://www.cnblogs.com/wgp13x/p/4859680.html">æˆ‘çš„ElasticSearché›†ç¾¤éƒ¨ç½²æ€»ç»“--å¤§æ•°æ®æœç´¢å¼•æ“ä½ ä¸å¾—ä¸çŸ¥</a></li>
<li><a href="http://my.oschina.net/shyloveliyi/blog/653751">elasticsearch2.3.1 é›†ç¾¤å®‰è£…</a></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2015-12-08T22:01:42+08:00" itemprop="datePublished">2015/12/8</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='lnmp.html'>lnmp</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="14812057029512.html" itemprop="url">
		æŸ¥çœ‹ MySQL æ•°æ®åº“ä¸­æ¯ä¸ªè¡¨å ç”¨çš„ç©ºé—´å¤§å°</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<p>å‡ºå¤„ï¼š<a href="http://www.oschina.net/question/12_3673">http://www.oschina.net/question/12_3673</a></p>

<blockquote>
<p>å¦‚æœæƒ³çŸ¥é“MySQLæ•°æ®åº“ä¸­æ¯ä¸ªè¡¨å ç”¨çš„ç©ºé—´ã€è¡¨è®°å½•çš„è¡Œæ•°çš„è¯ï¼Œå¯ä»¥æ‰“å¼€MySQLçš„ information_schema æ•°æ®åº“ã€‚åœ¨è¯¥åº“ä¸­æœ‰ä¸€ä¸ª TABLES è¡¨ï¼Œè¿™ä¸ªè¡¨ä¸»è¦å­—æ®µåˆ†åˆ«æ˜¯ï¼š<br/>
TABLE_SCHEMA : æ•°æ®åº“å<br/>
TABLE_NAMEï¼šè¡¨å<br/>
ENGINEï¼šæ‰€ä½¿ç”¨çš„å­˜å‚¨å¼•æ“<br/>
TABLES_ROWSï¼šè®°å½•æ•°<br/>
DATA_LENGTHï¼šæ•°æ®å¤§å°<br/>
INDEX_LENGTHï¼šç´¢å¼•å¤§å°<br/>
å…¶ä»–å­—æ®µè¯·å‚è€ƒMySQLçš„æ‰‹å†Œï¼Œæˆ‘ä»¬åªéœ€è¦äº†è§£è¿™å‡ ä¸ªå°±è¶³å¤Ÿäº†ã€‚<br/>
æ‰€ä»¥è¦çŸ¥é“ä¸€ä¸ªè¡¨å ç”¨ç©ºé—´çš„å¤§å°ï¼Œé‚£å°±ç›¸å½“äºæ˜¯ æ•°æ®å¤§å° + ç´¢å¼•å¤§å° å³å¯ã€‚<br/>
SQL:<br/>
<code>SELECT TABLE_NAME,DATA_LENGTH+INDEX_LENGTH,TABLE_ROWS FROM TABLES WHERE TABLE_SCHEMA=&#39;æ•°æ®åº“å&#39; AND TABLE_NAME=&#39;è¡¨å&#39;</code></p>
</blockquote>

<ol>
<li>è¿›å»æŒ‡å®šschema æ•°æ®åº“ï¼ˆå­˜æ”¾äº†å…¶ä»–çš„æ•°æ®åº“çš„ä¿¡æ¯ï¼‰
<code>mysql
mysql&gt; use information_schema;
Database changed
</code></li>
<li>æŸ¥è¯¢æ‰€æœ‰æ•°æ®çš„å¤§å°
<code>mysql
mysql&gt; select concat(round(sum(DATA_LENGTH/1024/1024), 2), &#39;MB&#39;)
-&gt; as data from TABLES;
+-----------+
| data      |
+-----------+
| 6674.48MB |
+-----------+
1 row in set (16.81 sec)
</code></li>
<li>æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„è¡¨çš„å¤§å°ï¼Œæ¯”å¦‚è¯´æ•°æ®åº“ forexpert ä¸­çš„ member è¡¨
<code>mysql
select concat(round(sum(DATA_LENGTH/1024/1024), 2), &#39;MB&#39;)
as data from TABLES where table_schema=&#39;forexpert&#39;;
+--------+
| data   |
+--------+
| 2.52MB |
+--------+
1 row in set (1.88 sec)
</code></li>
<li>æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“å®ä¾‹çš„å¤§å°ï¼Œæ¯”å¦‚è¯´æ•°æ®åº“ forexpert
<code>mysql
mysql&gt; select concat(round(sum(DATA_LENGTH/1024/1024), 2), &#39;MB&#39;)
-&gt; as data from TABLES where table_schema=&#39;forexpert&#39;;
+-----------+
| data      |
+-----------+
| 6542.30MB |
+-----------+
1 row in set (7.47 sec)
</code></li>
</ol>


			
			
		</div>

	</article>
  

</div>
<nav id="pagenavi">
	 
	
	<div class="center"><a href="archives.html">Blog Archives</a></div>

</nav>

</div>



        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>